# NetBox é…ç½®æ–‡ä»¶è¯´æ˜

## ğŸ“‹ **é…ç½®æ–‡ä»¶æ¦‚è¿°**

NetBoxä½¿ç”¨YAMLæ ¼å¼çš„é…ç½®æ–‡ä»¶æ¥ç®¡ç†æœåŠ¡å™¨çš„å„ç§å‚æ•°ã€‚é…ç½®æ–‡ä»¶é‡‡ç”¨åˆ†å±‚ç»“æ„ï¼Œæ”¯æŒä¸åŒçš„åº”ç”¨åœºæ™¯å’Œéƒ¨ç½²ç¯å¢ƒã€‚

## ğŸ”§ **é…ç½®æ–‡ä»¶ç»“æ„**

### **åŸºæœ¬ç»“æ„**

```yaml
application:          # åº”ç”¨é…ç½®
  type: string        # åº”ç”¨ç±»å‹
  
network:             # ç½‘ç»œé…ç½®
  ip: string         # ç›‘å¬IPåœ°å€
  port: integer      # ç›‘å¬ç«¯å£
  io_type: string    # IOå¤šè·¯å¤ç”¨ç±»å‹
  
threading:           # çº¿ç¨‹é…ç½®
  worker_threads: integer  # å·¥ä½œçº¿ç¨‹æ•°
  
logging:             # æ—¥å¿—é…ç½®
  level: string      # æ—¥å¿—çº§åˆ«
  async: boolean     # å¼‚æ­¥æ—¥å¿—å¼€å…³
```

## ğŸ“ **é…ç½®æ–‡ä»¶è¯¦è§£**

### **1. EchoæœåŠ¡å™¨é…ç½® (config_echo.yaml)**

```yaml
application:
  type: echo                    # åº”ç”¨ç±»å‹: Echoå›æ˜¾æœåŠ¡å™¨

network:
  ip: 192.168.88.135           # ç›‘å¬IPåœ°å€
  port: 8888                   # ç›‘å¬ç«¯å£
  io_type: epoll               # IOç±»å‹: epoll (Linuxæ¨è)

threading:
  worker_threads: 4            # å·¥ä½œçº¿ç¨‹æ•° (å»ºè®®ä¸ºCPUæ ¸å¿ƒæ•°)

logging:
  level: info                  # æ—¥å¿—çº§åˆ«: debug, info, warn, error
  async: true                  # å¯ç”¨å¼‚æ­¥æ—¥å¿—
```

**ç‰¹ç‚¹è¯´æ˜**:
- **åè®®**: ä½¿ç”¨SimpleHeaderåè®®ï¼Œæ”¯æŒé•¿åº¦å‰ç¼€
- **å¿ƒè·³**: å¯ç”¨å¿ƒè·³æœºåˆ¶ï¼Œç»´æŒé•¿è¿æ¥
- **ç”¨é€”**: åè®®è§£ææ¼”ç¤ºï¼Œç½‘ç»œç¼–ç¨‹æ•™å­¦

### **2. RedisæœåŠ¡å™¨é…ç½® (config_redis_app.yaml)**

```yaml
application:
  type: redis_app              # åº”ç”¨ç±»å‹: Redisæ•°æ®åº“æœåŠ¡å™¨

network:
  ip: 192.168.88.135          # ç›‘å¬IPåœ°å€
  port: 6380                  # ç›‘å¬ç«¯å£ (é¿å…ä¸æ ‡å‡†Rediså†²çª)
  io_type: epoll              # IOç±»å‹

threading:
  worker_threads: 8           # Rediséœ€è¦æ›´å¤šçº¿ç¨‹å¤„ç†å¹¶å‘

logging:
  level: info                 # æ—¥å¿—çº§åˆ«
  async: true                 # å¼‚æ­¥æ—¥å¿—
```

**ç‰¹ç‚¹è¯´æ˜**:
- **åè®®**: ä½¿ç”¨æ ‡å‡†Redis RESPåè®®
- **å¿ƒè·³**: æ™ºèƒ½ç¦ç”¨å¿ƒè·³ï¼Œé¿å…åè®®å†²çª
- **ç”¨é€”**: Redisæ•°æ®åº“æœåŠ¡ï¼Œå®Œæ•´å‘½ä»¤æ”¯æŒ

### **3. ç›´æ¥Redisé…ç½® (config_direct_redis.yaml)**

```yaml
application:
  type: direct_redis          # åº”ç”¨ç±»å‹: ç›´æ¥RedisæœåŠ¡å™¨

network:
  ip: 192.168.88.135         # ç›‘å¬IPåœ°å€
  port: 6379                 # æ ‡å‡†Redisç«¯å£
  io_type: epoll             # IOç±»å‹

threading:
  worker_threads: 6          # çº¿ç¨‹æ•°é…ç½®

logging:
  level: debug               # è°ƒè¯•çº§åˆ«æ—¥å¿—
  async: false               # åŒæ­¥æ—¥å¿— (è°ƒè¯•ç”¨)
```

**ç‰¹ç‚¹è¯´æ˜**:
- **åè®®**: çº¯Redisåè®®ï¼Œæ— åè®®è·¯ç”±
- **æ€§èƒ½**: æ›´é«˜æ€§èƒ½ï¼Œç›´æ¥å¤„ç†
- **ç”¨é€”**: ç”Ÿäº§ç¯å¢ƒRedisæœåŠ¡

## âš™ï¸ **é…ç½®å‚æ•°è¯¦è§£**

### **application åº”ç”¨é…ç½®**

| å‚æ•° | ç±»å‹ | å¯é€‰å€¼ | è¯´æ˜ |
|------|------|--------|------|
| `type` | string | `echo`, `redis_app`, `direct_redis` | åº”ç”¨æœåŠ¡å™¨ç±»å‹ |

#### **åº”ç”¨ç±»å‹è¯´æ˜**

- **echo**: Echoå›æ˜¾æœåŠ¡å™¨
  - ä½¿ç”¨SimpleHeaderåè®®
  - å¯ç”¨å¿ƒè·³æœºåˆ¶
  - é€‚åˆåè®®æ¼”ç¤ºå’Œæµ‹è¯•

- **redis_app**: Redisåº”ç”¨æœåŠ¡å™¨
  - ä½¿ç”¨RESPåè®® + åè®®è·¯ç”±
  - æ™ºèƒ½ç¦ç”¨å¿ƒè·³
  - å®Œæ•´Rediså‘½ä»¤æ”¯æŒ

- **direct_redis**: ç›´æ¥RedisæœåŠ¡å™¨
  - çº¯RESPåè®®å¤„ç†
  - æ— åè®®è·¯ç”±å¼€é”€
  - æœ€é«˜æ€§èƒ½Rediså®ç°

### **network ç½‘ç»œé…ç½®**

| å‚æ•° | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|--------|------|
| `ip` | string | `127.0.0.1` | ç›‘å¬IPåœ°å€ |
| `port` | integer | `8080` | ç›‘å¬ç«¯å£å· |
| `io_type` | string | `epoll` | IOå¤šè·¯å¤ç”¨ç±»å‹ |

#### **IOç±»å‹è¯´æ˜**

- **epoll**: Linuxæ¨èï¼Œé«˜æ€§èƒ½
- **select**: è·¨å¹³å°å…¼å®¹ï¼Œæ€§èƒ½ä¸€èˆ¬
- **poll**: Linux/Unixï¼Œæ€§èƒ½ä¸­ç­‰

#### **ç«¯å£åˆ†é…å»ºè®®**

| åº”ç”¨ç±»å‹ | æ¨èç«¯å£ | è¯´æ˜ |
|----------|----------|------|
| EchoæœåŠ¡å™¨ | 8888 | é¿å…ä¸å¸¸ç”¨æœåŠ¡å†²çª |
| RedisæœåŠ¡å™¨ | 6380 | é¿å…ä¸æ ‡å‡†Redis(6379)å†²çª |
| HTTPæœåŠ¡å™¨ | 8080 | å¸¸ç”¨Webå¼€å‘ç«¯å£ |

### **threading çº¿ç¨‹é…ç½®**

| å‚æ•° | ç±»å‹ | æ¨èå€¼ | è¯´æ˜ |
|------|------|--------|------|
| `worker_threads` | integer | CPUæ ¸å¿ƒæ•° | å·¥ä½œçº¿ç¨‹æ•°é‡ |

#### **çº¿ç¨‹æ•°é…ç½®å»ºè®®**

```yaml
# CPUå¯†é›†å‹åº”ç”¨
worker_threads: 4    # ç­‰äºCPUæ ¸å¿ƒæ•°

# IOå¯†é›†å‹åº”ç”¨ (å¦‚Redis)
worker_threads: 8    # 1.5-2å€CPUæ ¸å¿ƒæ•°

# é«˜å¹¶å‘åº”ç”¨
worker_threads: 16   # æ ¹æ®å®é™…è´Ÿè½½è°ƒæ•´
```

### **logging æ—¥å¿—é…ç½®**

| å‚æ•° | ç±»å‹ | å¯é€‰å€¼ | è¯´æ˜ |
|------|------|--------|------|
| `level` | string | `debug`, `info`, `warn`, `error` | æ—¥å¿—çº§åˆ« |
| `async` | boolean | `true`, `false` | å¼‚æ­¥æ—¥å¿—å¼€å…³ |

#### **æ—¥å¿—çº§åˆ«è¯´æ˜**

- **debug**: è¯¦ç»†è°ƒè¯•ä¿¡æ¯ï¼Œå¼€å‘é˜¶æ®µä½¿ç”¨
- **info**: ä¸€èˆ¬ä¿¡æ¯ï¼Œç”Ÿäº§ç¯å¢ƒæ¨è
- **warn**: è­¦å‘Šä¿¡æ¯ï¼Œå…³æ³¨æ½œåœ¨é—®é¢˜
- **error**: é”™è¯¯ä¿¡æ¯ï¼Œåªè®°å½•ä¸¥é‡é—®é¢˜

## ğŸ¯ **é…ç½®æœ€ä½³å®è·µ**

### **å¼€å‘ç¯å¢ƒé…ç½®**

```yaml
application:
  type: echo

network:
  ip: 127.0.0.1              # æœ¬åœ°å¼€å‘
  port: 8888
  io_type: select            # å…¼å®¹æ€§å¥½

threading:
  worker_threads: 2          # å¼€å‘æœºå™¨é…ç½®è¾ƒä½

logging:
  level: debug               # è¯¦ç»†æ—¥å¿—
  async: false               # åŒæ­¥æ—¥å¿—ï¼Œä¾¿äºè°ƒè¯•
```

### **æµ‹è¯•ç¯å¢ƒé…ç½®**

```yaml
application:
  type: redis_app

network:
  ip: 192.168.1.100         # æµ‹è¯•ç½‘ç»œ
  port: 6380
  io_type: epoll

threading:
  worker_threads: 4         # ä¸­ç­‰é…ç½®

logging:
  level: info               # é€‚ä¸­æ—¥å¿—
  async: true               # å¼‚æ­¥æ—¥å¿—
```

### **ç”Ÿäº§ç¯å¢ƒé…ç½®**

```yaml
application:
  type: direct_redis

network:
  ip: 0.0.0.0              # ç›‘å¬æ‰€æœ‰æ¥å£
  port: 6379
  io_type: epoll           # æœ€é«˜æ€§èƒ½

threading:
  worker_threads: 16       # é«˜å¹¶å‘é…ç½®

logging:
  level: warn              # åªè®°å½•é‡è¦ä¿¡æ¯
  async: true              # å¼‚æ­¥æ—¥å¿—ï¼Œå‡å°‘æ€§èƒ½å½±å“
```

## ğŸ” **é…ç½®éªŒè¯**

### **é…ç½®æ–‡ä»¶æ£€æŸ¥**

```bash
# æ£€æŸ¥YAMLè¯­æ³•
python3 -c "import yaml; yaml.safe_load(open('config/config_echo.yaml'))"

# å¯åŠ¨æ—¶éªŒè¯
./NetBox config/config_echo.yaml --validate-only
```

### **å¸¸è§é…ç½®é”™è¯¯**

1. **ç«¯å£å†²çª**
```yaml
# é”™è¯¯: ç«¯å£è¢«å ç”¨
port: 80    # éœ€è¦rootæƒé™

# æ­£ç¡®: ä½¿ç”¨é«˜ç«¯å£
port: 8080
```

2. **IPåœ°å€é”™è¯¯**
```yaml
# é”™è¯¯: æ— æ•ˆIP
ip: 192.168.1.256

# æ­£ç¡®: æœ‰æ•ˆIP
ip: 192.168.1.100
```

3. **çº¿ç¨‹æ•°é…ç½®ä¸å½“**
```yaml
# é”™è¯¯: çº¿ç¨‹æ•°è¿‡å¤š
worker_threads: 1000

# æ­£ç¡®: åˆç†çº¿ç¨‹æ•°
worker_threads: 8
```

## ğŸ“Š **é…ç½®æ€§èƒ½å½±å“**

### **IOç±»å‹æ€§èƒ½å¯¹æ¯”**

| IOç±»å‹ | å¹¶å‘è¿æ¥ | CPUä½¿ç”¨ç‡ | å†…å­˜ä½¿ç”¨ | æ¨èåœºæ™¯ |
|--------|----------|-----------|----------|----------|
| epoll | 10,000+ | ä½ | ä½ | Linuxç”Ÿäº§ç¯å¢ƒ |
| select | 1,024 | é«˜ | ä¸­ | è·¨å¹³å°å¼€å‘ |
| poll | æ— é™åˆ¶ | ä¸­ | ä¸­ | Unixç³»ç»Ÿ |

### **çº¿ç¨‹æ•°æ€§èƒ½å½±å“**

```
çº¿ç¨‹æ•° vs æ€§èƒ½ (QPS)
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
8000 â”‚                        â—    â”‚
     â”‚                   â—         â”‚
6000 â”‚              â—              â”‚
     â”‚         â—                   â”‚
4000 â”‚    â—                        â”‚
     â”‚â—                            â”‚
2000 â”‚                             â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      1   2   4   8   16  32  64
              çº¿ç¨‹æ•°
```

## ğŸ”§ **åŠ¨æ€é…ç½®**

### **çƒ­åŠ è½½æ”¯æŒ**

```cpp
// é…ç½®çƒ­åŠ è½½ (è®¡åˆ’åŠŸèƒ½)
ConfigManager::getInstance().reloadConfig();
```

### **è¿è¡Œæ—¶ä¿®æ”¹**

```bash
# é€šè¿‡ä¿¡å·ä¿®æ”¹æ—¥å¿—çº§åˆ«
kill -USR1 <pid>    # æå‡æ—¥å¿—çº§åˆ«
kill -USR2 <pid>    # é™ä½æ—¥å¿—çº§åˆ«
```

---

ğŸ“ **é…ç½®æ–‡ä»¶æ˜¯NetBoxçµæ´»æ€§çš„æ ¸å¿ƒï¼Œåˆç†é…ç½®èƒ½æ˜¾è‘—æå‡ç³»ç»Ÿæ€§èƒ½ï¼**
