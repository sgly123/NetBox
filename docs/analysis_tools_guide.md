# NetBox åˆ†æå·¥å…·ä½¿ç”¨æŒ‡å—

## ğŸ¯ æ¦‚è¿°

NetBox é¡¹ç›®æä¾›äº†å®Œæ•´çš„å†…å­˜æ³„æ¼æ£€æµ‹å’Œæ€§èƒ½åˆ†æå·¥å…·å¥—ä»¶ï¼Œå¸®åŠ©å¼€å‘è€…è¿›è¡Œä»£ç è´¨é‡æ£€æŸ¥å’Œæ€§èƒ½ä¼˜åŒ–ã€‚

## ğŸ”§ å·¥å…·æ¸…å•

### 1. å†…å­˜æ³„æ¼æ£€æµ‹ (Valgrind)
- **è„šæœ¬**: `tools/memory_check.sh`
- **å·¥å…·**: Valgrind Memcheck
- **åŠŸèƒ½**: æ£€æµ‹å†…å­˜æ³„æ¼ã€è¶Šç•Œè®¿é—®ã€æœªåˆå§‹åŒ–å†…å­˜ä½¿ç”¨

### 2. ç«ç„°å›¾æ€§èƒ½åˆ†æ (perf + FlameGraph)
- **è„šæœ¬**: `tools/flamegraph_analysis.sh`
- **å·¥å…·**: perf + FlameGraph
- **åŠŸèƒ½**: ç”ŸæˆCPUã€å†…å­˜ã€ç³»ç»Ÿè°ƒç”¨ç«ç„°å›¾

### 3. ä¸€é”®åˆ†æå¥—ä»¶
- **è„šæœ¬**: `tools/analysis_suite.sh`
- **åŠŸèƒ½**: æ•´åˆæ‰€æœ‰åˆ†æå·¥å…·ï¼Œç”Ÿæˆç»¼åˆæŠ¥å‘Š

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ä¸€é”®è¿è¡Œå®Œæ•´åˆ†æ
```bash
# åœ¨é¡¹ç›®æ ¹ç›®å½•è¿è¡Œ
chmod +x tools/analysis_suite.sh
./tools/analysis_suite.sh
```

### å•ç‹¬è¿è¡Œå†…å­˜æ£€æµ‹
```bash
chmod +x tools/memory_check.sh
./tools/memory_check.sh
```

### å•ç‹¬è¿è¡Œæ€§èƒ½åˆ†æ
```bash
chmod +x tools/flamegraph_analysis.sh
./tools/flamegraph_analysis.sh
```

## ğŸ“Š è¾“å‡ºæ–‡ä»¶

### å†…å­˜æ£€æµ‹è¾“å‡º
- `logs/memcheck_basic.log` - åŸºç¡€å†…å­˜æ£€æµ‹æ—¥å¿—
- `logs/memcheck_stress.log` - å‹åŠ›æµ‹è¯•å†…å­˜æ£€æµ‹æ—¥å¿—
- `logs/memory_report.md` - å†…å­˜æ£€æµ‹åˆ†ææŠ¥å‘Š

### æ€§èƒ½åˆ†æè¾“å‡º
- `logs/flamegraphs/cpu-flamegraph.svg` - CPUä½¿ç”¨ç‡ç«ç„°å›¾
- `logs/flamegraphs/memory-flamegraph.svg` - å†…å­˜åˆ†é…ç«ç„°å›¾
- `logs/flamegraphs/syscall-flamegraph.svg` - ç³»ç»Ÿè°ƒç”¨ç«ç„°å›¾
- `logs/performance_report.md` - æ€§èƒ½åˆ†ææŠ¥å‘Š

### ç»¼åˆåˆ†æè¾“å‡º
- `logs/comprehensive_analysis_report.md` - ç»¼åˆåˆ†ææŠ¥å‘Š

## ğŸ” æŸ¥çœ‹ç«ç„°å›¾

1. **åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€SVGæ–‡ä»¶**
   ```bash
   # Linux
   xdg-open logs/flamegraphs/cpu-flamegraph.svg
   
   # æˆ–è€…ç›´æ¥æ‹–æ‹½åˆ°æµè§ˆå™¨
   ```

2. **ç«ç„°å›¾äº¤äº’æ“ä½œ**
   - **é¼ æ ‡æ‚¬åœ**: æŸ¥çœ‹å‡½æ•°è¯¦ç»†ä¿¡æ¯
   - **ç‚¹å‡»**: æ”¾å¤§ç‰¹å®šåŒºåŸŸ
   - **æœç´¢**: æŒ‰Fé”®æœç´¢ç‰¹å®šå‡½æ•°
   - **ç¼©æ”¾**: é¼ æ ‡æ»šè½®ç¼©æ”¾

## ğŸ“ˆ åˆ†æç»“æœè§£è¯»

### å†…å­˜æ³„æ¼æ£€æµ‹
- **æ— æ³„æ¼**: æ˜¾ç¤º "æ— å†…å­˜æ³„æ¼"
- **æœ‰æ³„æ¼**: æ˜¾ç¤ºæ³„æ¼ç±»å‹å’Œä½ç½®
- **å»ºè®®**: æ ¹æ®æŠ¥å‘Šä¿®å¤å†…å­˜ç®¡ç†é—®é¢˜

### æ€§èƒ½ç«ç„°å›¾
- **CPUç«ç„°å›¾**: è¯†åˆ«CPUçƒ­ç‚¹å‡½æ•°
- **å†…å­˜ç«ç„°å›¾**: è¯†åˆ«å†…å­˜åˆ†é…çƒ­ç‚¹
- **ç³»ç»Ÿè°ƒç”¨ç«ç„°å›¾**: è¯†åˆ«I/Oç“¶é¢ˆ

## ğŸ› ï¸ å·¥å…·é…ç½®

### Valgrindé…ç½®
- **æ£€æµ‹çº§åˆ«**: å®Œæ•´æ£€æµ‹ (`--leak-check=full`)
- **æ³„æ¼ç±»å‹**: æ‰€æœ‰ç±»å‹ (`--show-leak-kinds=all`)
- **æ¥æºè·Ÿè¸ª**: å¯ç”¨ (`--track-origins=yes`)
- **æŠ‘åˆ¶æ–‡ä»¶**: `valgrind.supp`

### perfé…ç½®
- **é‡‡æ ·é¢‘ç‡**: 99Hz (`-F 99`)
- **é‡‡æ ·æ—¶é—´**: 10ç§’
- **è°ƒç”¨æ ˆ**: å¯ç”¨ (`-g`)

## ğŸ¯ æ ¡æ‹›åº”ç”¨

### é¢è¯•å‡†å¤‡
1. **å±•ç¤ºå·¥ç¨‹å®è·µèƒ½åŠ›**
   - å†…å­˜æ³„æ¼æ£€æµ‹æ„è¯†
   - æ€§èƒ½åˆ†æå·¥å…·ä½¿ç”¨
   - ä»£ç è´¨é‡ä¿è¯

2. **æŠ€æœ¯æ·±åº¦å±•ç¤º**
   - ç³»ç»Ÿç¼–ç¨‹çŸ¥è¯†
   - æ€§èƒ½ä¼˜åŒ–ç»éªŒ
   - é—®é¢˜è§£å†³èƒ½åŠ›

3. **é¡¹ç›®äº®ç‚¹**
   - å®Œæ•´çš„å·¥ç¨‹å·¥å…·é“¾
   - ä¸“ä¸šçš„åˆ†ææŠ¥å‘Š
   - å®é™…çš„é—®é¢˜è§£å†³

### ä½¿ç”¨å»ºè®®
1. **åœ¨ç®€å†ä¸­æåŠ**
   - "ä½¿ç”¨Valgrindè¿›è¡Œå†…å­˜æ³„æ¼æ£€æµ‹"
   - "ä½¿ç”¨perf+FlameGraphè¿›è¡Œæ€§èƒ½åˆ†æ"
   - "å»ºç«‹äº†å®Œæ•´çš„ä»£ç è´¨é‡ä¿è¯ä½“ç³»"

2. **åœ¨é¢è¯•ä¸­å±•ç¤º**
   - å±•ç¤ºåˆ†ææŠ¥å‘Š
   - è§£é‡Šç«ç„°å›¾å«ä¹‰
   - è¯´æ˜ä¼˜åŒ–æªæ–½

3. **é¡¹ç›®ä»·å€¼ä½“ç°**
   - å·¥ç¨‹åŒ–ç¨‹åº¦é«˜
   - ä»£ç è´¨é‡æœ‰ä¿è¯
   - æ€§èƒ½ä¼˜åŒ–æœ‰ä¾æ®

## ğŸ”§ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **Valgrindæœªå®‰è£…**
   ```bash
   sudo apt update
   sudo apt install valgrind
   ```

2. **perfæƒé™é—®é¢˜**
   ```bash
   # ä¸´æ—¶è§£å†³
   sudo sh -c 'echo -1 >/proc/sys/kernel/perf_event_paranoid'
   
   # æ°¸ä¹…è§£å†³
   sudo sh -c 'echo kernel.perf_event_paranoid = -1 >> /etc/sysctl.conf'
   sudo sysctl -p
   ```

3. **FlameGraphä¸‹è½½å¤±è´¥**
   ```bash
   cd tools
   git clone https://github.com/brendangregg/FlameGraph.git
   cd ..
   ```

### æ€§èƒ½å½±å“
- **Valgrind**: ä¼šæ˜¾è‘—é™ä½ç¨‹åºæ€§èƒ½ï¼Œä»…ç”¨äºæ£€æµ‹
- **perf**: å¯¹ç¨‹åºæ€§èƒ½å½±å“å¾ˆå°ï¼Œå¯ç”¨äºç”Ÿäº§ç¯å¢ƒ

## ğŸ“š å‚è€ƒèµ„æ–™

- [Valgrindå®˜æ–¹æ–‡æ¡£](https://valgrind.org/docs/manual/manual.html)
- [perfå®˜æ–¹æ–‡æ¡£](https://perf.wiki.kernel.org/)
- [FlameGraphé¡¹ç›®](https://github.com/brendangregg/FlameGraph)
- [Linuxæ€§èƒ½åˆ†æ](http://www.brendangregg.com/linuxperf.html)

## ğŸ‰ æ€»ç»“

NetBoxçš„åˆ†æå·¥å…·å¥—ä»¶æä¾›äº†ä¸“ä¸šçº§çš„ä»£ç è´¨é‡æ£€æŸ¥å’Œæ€§èƒ½åˆ†æèƒ½åŠ›ï¼Œä¸ä»…æœ‰åŠ©äºé¡¹ç›®å¼€å‘ï¼Œæ›´æ˜¯æ ¡æ‹›é¢è¯•ä¸­çš„äº®ç‚¹å±•ç¤ºã€‚

é€šè¿‡è¿™äº›å·¥å…·ï¼Œä½ å¯ä»¥ï¼š
1. ç¡®ä¿ä»£ç è´¨é‡
2. ä¼˜åŒ–æ€§èƒ½ç“¶é¢ˆ
3. å±•ç¤ºå·¥ç¨‹èƒ½åŠ›
4. æå‡é¢è¯•ç«äº‰åŠ› 