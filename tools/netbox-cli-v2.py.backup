#!/usr/bin/env python3
"""
NetBox CLI v2.0 - é‡æ„ç‰ˆæœ¬
ç®€åŒ–ã€å¯é ã€è‡ªåŒ…å«çš„è„šæ‰‹æ¶å·¥å…·

è®¾è®¡åŸåˆ™:
1. ç®€å•ä¼˜äºå¤æ‚ - æœ€å°å¯å·¥ä½œçš„é¡¹ç›®
2. å¯é ä¼˜äºåŠŸèƒ½ - ç¡®ä¿åœ¨ä»»ä½•ç¯å¢ƒä¸‹éƒ½èƒ½å·¥ä½œ
3. è‡ªåŒ…å«ä¼˜äºä¾èµ– - ä¸ä¾èµ–å¤–éƒ¨å¤æ‚æ¡†æ¶
4. æ¸è¿›ä¼˜äºä¸€æ¬¡æ€§ - æ”¯æŒä»ç®€å•åˆ°å¤æ‚çš„æ‰©å±•
"""

import os
import sys
import argparse
import subprocess
import platform
from pathlib import Path
from datetime import datetime
from typing import Dict, List, Optional
import json
import time
import random
import math

# ASCIIè‰ºæœ¯å­—å’ŒåŠ¨ç”»ç±»
class Colors:
    """ANSIé¢œè‰²ä»£ç """
    RESET = '\033[0m'
    BOLD = '\033[1m'
    DIM = '\033[2m'
    
    # åŸºç¡€é¢œè‰²
    BLACK = '\033[30m'
    RED = '\033[31m'
    GREEN = '\033[32m'
    YELLOW = '\033[33m'
    BLUE = '\033[34m'
    MAGENTA = '\033[35m'
    CYAN = '\033[36m'
    WHITE = '\033[37m'
    
    # äº®è‰²
    BRIGHT_BLACK = '\033[90m'
    BRIGHT_RED = '\033[91m'
    BRIGHT_GREEN = '\033[92m'
    BRIGHT_YELLOW = '\033[93m'
    BRIGHT_BLUE = '\033[94m'
    BRIGHT_MAGENTA = '\033[95m'
    BRIGHT_CYAN = '\033[96m'
    BRIGHT_WHITE = '\033[97m'
    
    # èƒŒæ™¯è‰²
    BG_BLACK = '\033[40m'
    BG_RED = '\033[41m'
    BG_GREEN = '\033[42m'
    BG_YELLOW = '\033[43m'
    BG_BLUE = '\033[44m'
    BG_MAGENTA = '\033[45m'
    BG_CYAN = '\033[46m'
    BG_WHITE = '\033[47m'

class ASCIIArt:
    """ASCIIè‰ºæœ¯å­—ç”Ÿæˆå™¨"""
    
    # NetBoxå¤§æ ‡é¢˜ASCIIè‰ºæœ¯å­—
    NETBOX_LOGO = [
        "â–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ•—  â–ˆâ–ˆâ•—",
        "â–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•â•â•â•šâ•â•â–ˆâ–ˆâ•”â•â•â•â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â•â–ˆâ–ˆâ•—â•šâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•",
        "â–ˆâ–ˆâ•”â–ˆâ–ˆâ•— â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—     â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘ â•šâ–ˆâ–ˆâ–ˆâ•”â• ",
        "â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•     â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘ â–ˆâ–ˆâ•”â–ˆâ–ˆâ•— ",
        "â–ˆâ–ˆâ•‘ â•šâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•”â• â–ˆâ–ˆâ•—",
        "â•šâ•â•  â•šâ•â•â•â•â•šâ•â•â•â•â•â•â•   â•šâ•â•   â•šâ•â•â•â•â•â•  â•šâ•â•â•â•â•â• â•šâ•â•  â•šâ•â•"
    ]
    
    # NetBoxé¡¹ç›®æ ‡é¢˜
    FRAMEWORK_TITLE = [
        "â–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ•—  â–ˆâ–ˆâ•—",
        "â–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•â•â•â•šâ•â•â–ˆâ–ˆâ•”â•â•â•â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â•â–ˆâ–ˆâ•—â•šâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•",
        "â–ˆâ–ˆâ•”â–ˆâ–ˆâ•— â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—     â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘ â•šâ–ˆâ–ˆâ–ˆâ•”â• ",
        "â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•     â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘ â–ˆâ–ˆâ•”â–ˆâ–ˆâ•— ",
        "â–ˆâ–ˆâ•‘ â•šâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•”â• â–ˆâ–ˆâ•—",
        "â•šâ•â•  â•šâ•â•â•â•â•šâ•â•â•â•â•â•â•   â•šâ•â•   â•šâ•â•â•â•â•â•  â•šâ•â•â•â•â•â• â•šâ•â•  â•šâ•â•"
    ]
    
    # NetBoxå°æ ‡é¢˜
    NETBOX_SUBTITLE = [
        "â•”â•—â•”â”Œâ”€â”â”Œâ”¬â”â•”â•— â”Œâ”€â”â”€â” â”¬",
        "â•‘â•‘â•‘â”œâ”¤  â”‚ â• â•©â•—â”‚ â”‚â”Œâ”´â”¬â”˜",
        "â•â•šâ•â””â”€â”˜ â”´ â•šâ•â•â””â”€â”˜â”´ â””â”€"
    ]
    
    # åˆ›å»ºé¡¹ç›®åŠ¨ç”»å¸§
    CREATING_FRAMES = [
        ["â ‹", "â ™", "â ¹", "â ¸", "â ¼", "â ´", "â ¦", "â §", "â ‡", "â "],  # æ—‹è½¬
        ["â–", "â–ƒ", "â–„", "â–…", "â–†", "â–‡", "â–ˆ", "â–‡", "â–†", "â–…", "â–„", "â–ƒ"],  # è¿›åº¦æ¡
        ["â—", "â—“", "â—‘", "â—’"],  # åœ†å½¢æ—‹è½¬
        ["â£¾", "â£½", "â£»", "â¢¿", "â¡¿", "â£Ÿ", "â£¯", "â£·"]  # ç‚¹é˜µæ—‹è½¬
    ]
    
    @staticmethod
    def get_gradient_colors() -> List[str]:
        """è·å–æ¸å˜è‰²å½©åºåˆ—"""
        return [
            Colors.BRIGHT_CYAN,
            Colors.CYAN,
            Colors.BRIGHT_BLUE,
            Colors.BLUE,
            Colors.BRIGHT_MAGENTA,
            Colors.MAGENTA
        ]
    
    @staticmethod
    def colorize_text(text: str, color: str) -> str:
        """ä¸ºæ–‡æœ¬æ·»åŠ é¢œè‰²"""
        return f"{color}{text}{Colors.RESET}"
    
    @staticmethod
    def rainbow_text(text: str) -> str:
        """å½©è™¹æ–‡å­—æ•ˆæœ"""
        colors = [Colors.RED, Colors.YELLOW, Colors.GREEN, Colors.CYAN, Colors.BLUE, Colors.MAGENTA]
        result = ""
        for i, char in enumerate(text):
            color = colors[i % len(colors)]
            result += f"{color}{char}{Colors.RESET}"
        return result

class Animations:
    """åŠ¨ç”»æ•ˆæœç±»"""
    
    @staticmethod
    def clear_screen():
        """æ¸…å±"""
        os.system('cls' if os.name == 'nt' else 'clear')
    
    @staticmethod
    def move_cursor(x: int, y: int):
        """ç§»åŠ¨å…‰æ ‡"""
        print(f"\033[{y};{x}H", end="")
    
    @staticmethod
    def hide_cursor():
        """éšè—å…‰æ ‡"""
        print("\033[?25l", end="")
    
    @staticmethod
    def show_cursor():
        """æ˜¾ç¤ºå…‰æ ‡"""
        print("\033[?25h", end="")
    
    @staticmethod
    def typewriter_effect(text: str, delay: float = 0.05, color: str = ""):
        """æ‰“å­—æœºæ•ˆæœ"""
        for char in text:
            print(f"{color}{char}{Colors.RESET}", end="", flush=True)
            time.sleep(delay)
        print()
    
    @staticmethod
    def fade_in_logo(logo: List[str], colors: List[str], delay: float = 0.1):
        """æ¸å…¥Logoæ•ˆæœ"""
        for i, line in enumerate(logo):
            color = colors[i % len(colors)]
            print(f"{color}{line}{Colors.RESET}")
            time.sleep(delay)
    
    @staticmethod
    def rainbow_logo(logo: List[str], delay: float = 0.05):
        """å½©è™¹Logoæ•ˆæœ"""
        for line in logo:
            print(ASCIIArt.rainbow_text(line))
            time.sleep(delay)
    
    @staticmethod
    def spinning_loader(text: str, duration: float = 3.0, frame_set: int = 0):
        """æ—‹è½¬åŠ è½½å™¨"""
        frames = ASCIIArt.CREATING_FRAMES[frame_set]
        start_time = time.time()
        frame_index = 0
        
        while time.time() - start_time < duration:
            frame = frames[frame_index % len(frames)]
            print(f"\r{Colors.BRIGHT_CYAN}{frame}{Colors.RESET} {text}", end="", flush=True)
            time.sleep(0.1)
            frame_index += 1
        
        print(f"\r{Colors.BRIGHT_GREEN}âœ…{Colors.RESET} {text}")
    
    @staticmethod
    def progress_bar(text: str, steps: List[str], delay: float = 0.5, style: str = "blocks"):
        """è¿›åº¦æ¡åŠ¨ç”»"""
        print(f"\n{Colors.BRIGHT_CYAN}{text}{Colors.RESET}")
        
        if style == "blocks":
            blocks = ["â¬œ", "â¬›"]
        elif style == "dots":
            blocks = ["â—‹", "â—"]
        elif style == "arrows":
            blocks = ["â†’", "â†’"]
        elif style == "squares":
            blocks = ["â–¡", "â– "]
        elif style == "circles":
            blocks = ["â—‹", "â—"]
        elif style == "gradient":
            blocks = ["â–‘", "â–’", "â–“", "â–ˆ"]
        elif style == "wave":
            blocks = ["â–", "â–ƒ", "â–„", "â–…", "â–†", "â–‡", "â–ˆ"]
        elif style == "pulse":
            blocks = ["â—‹", "â—", "â—", "â—‘"]
        elif style == "rainbow":
            blocks = ["ğŸ”´", "ğŸŸ ", "ğŸŸ¡", "ğŸŸ¢", "ğŸ”µ", "ğŸŸ£"]
        else:
            blocks = ["â¬œ", "â¬›"]
        
        total_steps = len(steps)
        bar_length = 50
        
        for i, step in enumerate(steps):
            progress = (i + 1) / total_steps
            filled_length = int(bar_length * progress)
            
            if style == "gradient":
                bar = ""
                for j in range(bar_length):
                    if j < filled_length:
                        block_index = min(int(j / filled_length * len(blocks)), len(blocks) - 1)
                        bar += blocks[block_index]
                    else:
                        bar += blocks[0]
            elif style == "rainbow":
                bar = ""
                for j in range(bar_length):
                    if j < filled_length:
                        color_index = j % len(blocks)
                        bar += blocks[color_index]
                    else:
                        bar += blocks[0]
            else:
                bar = blocks[1] * filled_length + blocks[0] * (bar_length - filled_length)
            
            percentage = int(progress * 100)
            print(f"\r[{bar}] {percentage}% - {step}", end="", flush=True)
            time.sleep(delay)
        
        print(f"\n{Colors.BRIGHT_GREEN}âœ… å®Œæˆ!{Colors.RESET}")
    
    @staticmethod
    def animated_progress_bar(text: str, duration: float = 5.0, style: str = "wave"):
        """åŠ¨ç”»è¿›åº¦æ¡"""
        print(f"\n{Colors.BRIGHT_CYAN}{text}{Colors.RESET}")
        
        if style == "wave":
            frames = ["â–â–‚â–ƒâ–„â–…â–†â–‡â–ˆ", "â–‚â–ƒâ–„â–…â–†â–‡â–ˆâ–", "â–ƒâ–„â–…â–†â–‡â–ˆâ–â–‚", "â–„â–…â–†â–‡â–ˆâ–â–‚â–ƒ", 
                     "â–…â–†â–‡â–ˆâ–â–‚â–ƒâ–„", "â–†â–‡â–ˆâ–â–‚â–ƒâ–„â–…", "â–‡â–ˆâ–â–‚â–ƒâ–„â–…â–†", "â–ˆâ–â–‚â–ƒâ–„â–…â–†â–‡"]
        elif style == "pulse":
            frames = ["â—‹â—â—‹â—â—‹â—â—‹â—", "â—â—‹â—â—‹â—â—‹â—â—‹", "â—‹â—â—‹â—â—‹â—â—‹â—", "â—â—‹â—â—‹â—â—‹â—â—‹"]
        else:
            frames = ["â ‹â ™â ¹â ¸â ¼â ´â ¦â §â ‡â ", "â ™â ¹â ¸â ¼â ´â ¦â §â ‡â â ‹", "â ¹â ¸â ¼â ´â ¦â §â ‡â â ‹â ™"]
        
        start_time = time.time()
        frame_index = 0
        
        while time.time() - start_time < duration:
            frame = frames[frame_index % len(frames)]
            progress = (time.time() - start_time) / duration
            bar_length = 40
            filled_length = int(bar_length * progress)
            
            bar = frame[:filled_length] + " " * (bar_length - filled_length)
            percentage = int(progress * 100)
            
            print(f"\r[{bar}] {percentage}%", end="", flush=True)
            time.sleep(0.1)
            frame_index += 1
        
        print(f"\n{Colors.BRIGHT_GREEN}âœ… å®Œæˆ!{Colors.RESET}")
    
    @staticmethod
    def multi_progress_bars(tasks: List[dict], update_interval: float = 0.1):
        """å¤šè¿›åº¦æ¡"""
        print(f"\n{Colors.BRIGHT_CYAN}ğŸ”§ é¡¹ç›®ç”Ÿæˆè¿›åº¦{Colors.RESET}")
        
        # ä¿å­˜å…‰æ ‡ä½ç½®
        print("\033[s", end="")
        
        for task in tasks:
            task_name = task.get("name", "æœªçŸ¥ä»»åŠ¡")
            duration = task.get("duration", 2.0)
            style = task.get("style", "blocks")
            
            print(f"\n{Colors.BRIGHT_YELLOW}{task_name}{Colors.RESET}")
            Animations.animated_progress_bar(task_name, duration, style)
    
    @staticmethod
    def matrix_effect(duration: float = 2.0):
        """çŸ©é˜µæ•ˆæœ"""
        width = 80
        height = 20
        matrix = [[' ' for _ in range(width)] for _ in range(height)]
        
        start_time = time.time()
        while time.time() - start_time < duration:
            # éšæœºæ·»åŠ å­—ç¬¦
            for _ in range(5):
                x = random.randint(0, width - 1)
                y = random.randint(0, height - 1)
                matrix[y][x] = random.choice('01')
            
            # æ˜¾ç¤ºçŸ©é˜µ
            Animations.clear_screen()
            for row in matrix:
                print(f"{Colors.BRIGHT_GREEN}{''.join(row)}{Colors.RESET}")
            
            # éšæœºæ¸…é™¤å­—ç¬¦
            for _ in range(3):
                x = random.randint(0, width - 1)
                y = random.randint(0, height - 1)
                matrix[y][x] = ' '
            
            time.sleep(0.1)
        
        Animations.clear_screen()
        Animations.show_cursor()

def show_startup_animation():
    """æ˜¾ç¤ºå¯åŠ¨åŠ¨ç”»"""
    try:
        Animations.clear_screen()
        
        # çŸ©é˜µæ•ˆæœ
        print(f"{Colors.BRIGHT_GREEN}åˆå§‹åŒ–NetBox...{Colors.RESET}")
        Animations.matrix_effect(1.5)
        
        # æ˜¾ç¤ºLogo
        print(f"\n{Colors.BOLD}{Colors.BRIGHT_CYAN}æ¬¢è¿ä½¿ç”¨{Colors.RESET}")
        Animations.rainbow_logo(ASCIIArt.NETBOX_LOGO, 0.03)
        
        print(f"\n{Colors.BRIGHT_YELLOW}{'=' * 60}{Colors.RESET}")
        Animations.typewriter_effect(
            "ğŸš€ NetBox CLI v2.0 - ä¼ä¸šçº§è·¨å¹³å°ç½‘ç»œæ¡†æ¶",
            0.03,
            Colors.BRIGHT_WHITE
        )
        print(f"{Colors.BRIGHT_YELLOW}{'=' * 60}{Colors.RESET}\n")
        
        # ç‰¹æ€§å±•ç¤º
        features = [
            "ğŸ”Œ åè®®å±‚æ‰©å±•æ¥å£",
            "ğŸ¯ åº”ç”¨å±‚æ‰©å±•æ¥å£", 
            "ğŸŒ ç½‘ç»œå±‚ä¼˜åŒ–æ¥å£",
            "ğŸ”Œ æ’ä»¶åŒ–æ¶æ„",
            "ğŸ¨ ç°ä»£åŒ–è„šæ‰‹æ¶"
        ]
        
        for feature in features:
            Animations.typewriter_effect(f"   {feature}", 0.02, Colors.BRIGHT_CYAN)
            time.sleep(0.1)
        
        print()
        
    except KeyboardInterrupt:
        Animations.show_cursor()
        print(f"\n{Colors.BRIGHT_RED}å¯åŠ¨è¢«ä¸­æ–­{Colors.RESET}")

def show_project_creation_animation(project_name: str):
    """æ˜¾ç¤ºé¡¹ç›®åˆ›å»ºåŠ¨ç”»"""
    try:
        print(f"\n{Colors.BOLD}{Colors.BRIGHT_MAGENTA}åˆ›å»ºé¡¹ç›®: {project_name}{Colors.RESET}")
        Animations.fade_in_logo(ASCIIArt.FRAMEWORK_TITLE, ASCIIArt.get_gradient_colors(), 0.05)
        
        # åˆ›å»ºæ­¥éª¤
        steps = [
            "åˆå§‹åŒ–NetBoxé¡¹ç›®ç»“æ„",
            "ç”ŸæˆNetBoxæ ¸å¿ƒæ–‡ä»¶",
            "åˆ›å»ºåè®®æ‰©å±•æ¥å£",
            "è®¾ç½®åº”ç”¨å±‚æ¥å£",
            "é…ç½®ç½‘ç»œå±‚æ¥å£",
            "åˆå§‹åŒ–æ’ä»¶ç³»ç»Ÿ",
            "ç”Ÿæˆç¤ºä¾‹ä»£ç ",
            "åˆ›å»ºCMakeæ„å»ºé…ç½®",
            "ç”Ÿæˆé¡¹ç›®æ–‡æ¡£"
        ]
        
        print(f"\n{Colors.BRIGHT_YELLOW}æ­£åœ¨åˆ›å»ºé¡¹ç›®...{Colors.RESET}\n")

        # ä½¿ç”¨å¢å¼ºçš„è¿›åº¦æ¡ï¼Œéšæœºé€‰æ‹©é£æ ¼
        styles = ["blocks", "gradient", "circles", "squares"]
        selected_style = random.choice(styles)
        Animations.progress_bar("ğŸ”§ é¡¹ç›®ç”Ÿæˆè¿›åº¦", steps, 0.4, selected_style)
        
        # æˆåŠŸåŠ¨ç”»
        print(f"\n{Colors.BRIGHT_GREEN}{'ğŸ‰' * 20}{Colors.RESET}")
        Animations.typewriter_effect(
            f"âœ… é¡¹ç›® {project_name} åˆ›å»ºæˆåŠŸ!", 
            0.05, 
            Colors.BRIGHT_GREEN
        )
        print(f"{Colors.BRIGHT_GREEN}{'ğŸ‰' * 20}{Colors.RESET}\n")
        
    except KeyboardInterrupt:
        Animations.show_cursor()
        print(f"\n{Colors.BRIGHT_RED}åˆ›å»ºè¢«ä¸­æ–­{Colors.RESET}")

def show_simple_banner():
    """æ˜¾ç¤ºç®€å•æ¨ªå¹…"""
    print(f"{Colors.BRIGHT_CYAN}ğŸ† NetBox CLI v2.0{Colors.RESET}")
    print(f"{Colors.BRIGHT_YELLOW}{'=' * 20}{Colors.RESET}")

# å¯¼å…¥ASCIIè‰ºæœ¯æ¨¡å—
try:
    from ascii_art import show_startup_animation, show_project_creation_animation, show_simple_banner
    ASCII_ART_AVAILABLE = True
except ImportError:
    ASCII_ART_AVAILABLE = False

class NetBoxCLI:
    """NetBox CLI v2.0 - ç®€åŒ–ç‰ˆæœ¬"""
    
    def __init__(self):
        # æ™ºèƒ½è·¯å¾„æ£€æµ‹
        script_path = Path(__file__).resolve()
        self.root_dir = script_path.parent.parent
        
        # ç¡®ä¿è¿™æ˜¯NetBoxæ ¹ç›®å½•
        if not (self.root_dir / "tools").exists():
            current_dir = Path.cwd()
            if (current_dir / "NetBox" / "tools").exists():
                self.root_dir = current_dir / "NetBox"
            elif (current_dir.parent / "NetBox" / "tools").exists():
                self.root_dir = current_dir.parent / "NetBox"
        
        self.version = "2.0.0"
        self.config = self._load_default_config()
    
    def _load_default_config(self) -> Dict:
        """åŠ è½½é»˜è®¤é…ç½®"""
        return {
            "project": {
                "default_name": "MyNetBoxProject",
                "version": "1.0.0",
                "author": "NetBox Developer"
            },
            "build": {
                "default_type": "Release",
                "parallel_jobs": 4
            },
            "features": {
                "logging": True,
                "testing": True,
                "examples": True
            }
        }
    
    def detect_platform(self) -> str:
        """æ£€æµ‹å½“å‰å¹³å°"""
        system = platform.system().lower()
        if system == "windows":
            return "windows"
        elif system == "darwin":
            return "macos"
        elif system == "linux":
            return "linux"
        else:
            return "unknown"
    
    def run_command(self, cmd: List[str], cwd: Optional[Path] = None) -> bool:
        """æ‰§è¡Œå‘½ä»¤"""
        try:
            result = subprocess.run(
                cmd, 
                cwd=cwd or Path.cwd(), 
                capture_output=False, 
                text=True
            )
            return result.returncode == 0
        except Exception as e:
            print(f"âŒ å‘½ä»¤æ‰§è¡Œå¤±è´¥: {e}")
            return False
    
    def create_directory_structure(self, project_dir: Path) -> bool:
        """åˆ›å»ºåŸºç¡€ç›®å½•ç»“æ„"""
        directories = [
            "src",
            "include/netbox",
            "examples/basic",
            "tests",
            "docs",
            "config",
            "cmake"
        ]
        
        try:
            for dir_path in directories:
                (project_dir / dir_path).mkdir(parents=True, exist_ok=True)
            return True
        except Exception as e:
            print(f"âŒ åˆ›å»ºç›®å½•ç»“æ„å¤±è´¥: {e}")
            return False
    
    def create_basic_files(self, project_dir: Path, project_name: str) -> bool:
        """åˆ›å»ºåŸºç¡€æ–‡ä»¶"""
        try:
            # 1. åˆ›å»ºä¸»å¤´æ–‡ä»¶
            self._create_main_header(project_dir, project_name)
            
            # 2. åˆ›å»ºåŸºç¡€æºæ–‡ä»¶
            self._create_basic_source(project_dir, project_name)
            
            # 3. åˆ›å»ºç¤ºä¾‹ç¨‹åº
            self._create_example_program(project_dir, project_name)
            
            # 4. åˆ›å»ºCMakeLists.txt
            self._create_cmake_config(project_dir, project_name)
            
            # 5. åˆ›å»ºæµ‹è¯•æ–‡ä»¶
            self._create_test_files(project_dir, project_name)
            
            # 6. åˆ›å»ºREADME
            self._create_readme(project_dir, project_name)
            
            return True
        except Exception as e:
            print(f"âŒ åˆ›å»ºåŸºç¡€æ–‡ä»¶å¤±è´¥: {e}")
            return False
    
    def _create_main_header(self, project_dir: Path, project_name: str):
        """åˆ›å»ºä¸»å¤´æ–‡ä»¶ - ç®€åŒ–ç‰ˆæœ¬"""
        # Windowsä¸‹é¿å…ä¸­æ–‡å­—ç¬¦ï¼Œä½¿ç”¨è‹±æ–‡æ³¨é‡Š
        if self.detect_platform() == "windows":
            header_content = f'''#pragma once

/**
 * @file NetBox.h
 * @brief {project_name} - NetBox Framework Header
 * @version 1.0.0
 * @date {datetime.now().strftime('%Y-%m-%d')}
 */

#include <iostream>
#include <string>
#include <memory>
#include <vector>
#include <functional>

namespace NetBox {{

/**
 * @brief Framework version information
 */
struct Version {{
    static constexpr const char* STRING = "1.0.0";
    static constexpr int MAJOR = 1;
    static constexpr int MINOR = 0;
    static constexpr int PATCH = 0;
}};

/**
 * @brief Simple application base class
 */
class Application {{
public:
    Application(const std::string& name) : m_name(name) {{}}
    virtual ~Application() = default;

    virtual bool initialize() {{
        std::cout << "Initializing application: " << m_name << std::endl;
        return true;
    }}

    virtual bool start() {{
        std::cout << "Starting application: " << m_name << std::endl;
        return true;
    }}

    virtual void stop() {{
        std::cout << "Stopping application: " << m_name << std::endl;
    }}

    const std::string& getName() const {{ return m_name; }}

private:
    std::string m_name;
}};

/**
 * @brief Framework initialization
 */
inline bool initialize() {{
    std::cout << "NetBox framework initializing..." << std::endl;
    return true;
}}

/**
 * @brief Framework cleanup
 */
inline void cleanup() {{
    std::cout << "NetBox framework cleanup..." << std::endl;
}}

}} // namespace NetBox

// Convenience macros
#define NETBOX_VERSION NetBox::Version::STRING
#define NETBOX_INIT() NetBox::initialize()
#define NETBOX_CLEANUP() NetBox::cleanup()
'''
        else:
            header_content = f'''#pragma once

/**
 * @file NetBox.h
 * @brief {project_name} - NetBoxæ¡†æ¶å¤´æ–‡ä»¶
 * @version 1.0.0
 * @date {datetime.now().strftime('%Y-%m-%d')}
 */

#include <iostream>
#include <string>
#include <memory>
#include <vector>
#include <functional>

namespace NetBox {{

/**
 * @brief æ¡†æ¶ç‰ˆæœ¬ä¿¡æ¯
 */
struct Version {{
    static constexpr const char* STRING = "1.0.0";
    static constexpr int MAJOR = 1;
    static constexpr int MINOR = 0;
    static constexpr int PATCH = 0;
}};

/**
 * @brief ç®€å•çš„åº”ç”¨ç¨‹åºåŸºç±»
 */
class Application {{
public:
    Application(const std::string& name) : m_name(name) {{}}
    virtual ~Application() = default;

    virtual bool initialize() {{
        std::cout << "ğŸ”§ åˆå§‹åŒ–åº”ç”¨: " << m_name << std::endl;
        return true;
    }}

    virtual bool start() {{
        std::cout << "ğŸš€ å¯åŠ¨åº”ç”¨: " << m_name << std::endl;
        return true;
    }}

    virtual void stop() {{
        std::cout << "ğŸ›‘ åœæ­¢åº”ç”¨: " << m_name << std::endl;
    }}

    const std::string& getName() const {{ return m_name; }}

private:
    std::string m_name;
}};

/**
 * @brief æ¡†æ¶åˆå§‹åŒ–
 */
inline bool initialize() {{
    std::cout << "ğŸ”§ NetBoxæ¡†æ¶åˆå§‹åŒ–..." << std::endl;
    return true;
}}

/**
 * @brief æ¡†æ¶æ¸…ç†
 */
inline void cleanup() {{
    std::cout << "ğŸ§¹ NetBoxæ¡†æ¶æ¸…ç†..." << std::endl;
}}

}} // namespace NetBox

// ä¾¿åˆ©å®
#define NETBOX_VERSION NetBox::Version::STRING
#define NETBOX_INIT() NetBox::initialize()
#define NETBOX_CLEANUP() NetBox::cleanup()
'''
        
        header_path = project_dir / "include" / "netbox" / "NetBox.h"
        # Windowsä¸‹ä½¿ç”¨UTF-8 BOMç¼–ç é¿å…C4819è­¦å‘Š
        encoding = 'utf-8-sig' if self.detect_platform() == "windows" else 'utf-8'
        header_path.write_text(header_content, encoding=encoding)
        print(f"âœ… åˆ›å»ºå¤´æ–‡ä»¶: {header_path}")
    
    def _create_basic_source(self, project_dir: Path, project_name: str):
        """åˆ›å»ºåŸºç¡€æºæ–‡ä»¶"""
        # Windowsä¸‹é¿å…ä¸­æ–‡å­—ç¬¦
        if self.detect_platform() == "windows":
            source_content = f'''/**
 * @file main.cpp
 * @brief {project_name} - Main program file
 */

#include "netbox/NetBox.h"

int main() {{
    std::cout << "Welcome to {project_name}!" << std::endl;
    std::cout << "Based on NetBox Framework v" << NETBOX_VERSION << std::endl;

    // Initialize framework
    if (!NETBOX_INIT()) {{
        std::cerr << "Framework initialization failed" << std::endl;
        return 1;
    }}

    // Create application
    NetBox::Application app("{project_name}");

    if (app.initialize() && app.start()) {{
        std::cout << "Application started successfully!" << std::endl;
        std::cout << "Press Enter to exit..." << std::endl;
        std::cin.get();
        app.stop();
    }}

    // Cleanup framework
    NETBOX_CLEANUP();

    return 0;
}}
'''
        else:
            source_content = f'''/**
 * @file main.cpp
 * @brief {project_name} - ä¸»ç¨‹åºæ–‡ä»¶
 */

#include "netbox/NetBox.h"

int main() {{
    std::cout << "ğŸŒŸ æ¬¢è¿ä½¿ç”¨ {project_name}!" << std::endl;
    std::cout << "åŸºäºNetBoxæ¡†æ¶ v" << NETBOX_VERSION << std::endl;

    // åˆå§‹åŒ–æ¡†æ¶
    if (!NETBOX_INIT()) {{
        std::cerr << "âŒ æ¡†æ¶åˆå§‹åŒ–å¤±è´¥" << std::endl;
        return 1;
    }}

    // åˆ›å»ºåº”ç”¨
    NetBox::Application app("{project_name}");

    if (app.initialize() && app.start()) {{
        std::cout << "âœ… åº”ç”¨å¯åŠ¨æˆåŠŸ!" << std::endl;
        std::cout << "æŒ‰Enteré”®é€€å‡º..." << std::endl;
        std::cin.get();
        app.stop();
    }}

    // æ¸…ç†æ¡†æ¶
    NETBOX_CLEANUP();

    return 0;
}}
'''
        
        source_path = project_dir / "src" / "main.cpp"
        # Windowsä¸‹ä½¿ç”¨UTF-8 BOMç¼–ç é¿å…C4819è­¦å‘Š
        encoding = 'utf-8-sig' if self.detect_platform() == "windows" else 'utf-8'
        source_path.write_text(source_content, encoding=encoding)
        print(f"âœ… åˆ›å»ºæºæ–‡ä»¶: {source_path}")

    def _create_example_program(self, project_dir: Path, project_name: str):
        """åˆ›å»ºç¤ºä¾‹ç¨‹åº"""
        example_content = f'''/**
 * @file simple_example.cpp
 * @brief {project_name} - ç®€å•ç¤ºä¾‹ç¨‹åº
 */

#include "netbox/NetBox.h"
#include <thread>
#include <chrono>

class SimpleApp : public NetBox::Application {{
public:
    SimpleApp() : NetBox::Application("{project_name}Example") {{}}

    bool initialize() override {{
        std::cout << "ğŸ”§ åˆå§‹åŒ–ç¤ºä¾‹åº”ç”¨..." << std::endl;
        return true;
    }}

    bool start() override {{
        std::cout << "ğŸš€ å¯åŠ¨ç¤ºä¾‹åº”ç”¨..." << std::endl;

        // æ¨¡æ‹Ÿä¸€äº›å·¥ä½œ
        for (int i = 1; i <= 3; i++) {{
            std::cout << "ğŸ“Š å¤„ç†ä»»åŠ¡ " << i << "/3..." << std::endl;
            std::this_thread::sleep_for(std::chrono::milliseconds(500));
        }}

        std::cout << "âœ… æ‰€æœ‰ä»»åŠ¡å®Œæˆ!" << std::endl;
        return true;
    }}
}};

int main() {{
    std::cout << "ğŸ¯ {project_name} ç¤ºä¾‹ç¨‹åº" << std::endl;
    std::cout << "=========================" << std::endl;

    NETBOX_INIT();

    SimpleApp app;
    if (app.initialize() && app.start()) {{
        std::cout << "ğŸ‰ ç¤ºä¾‹è¿è¡ŒæˆåŠŸ!" << std::endl;
    }}

    NETBOX_CLEANUP();
    return 0;
}}
'''

        example_path = project_dir / "examples" / "basic" / "simple_example.cpp"
        example_path.write_text(example_content, encoding='utf-8')
        print(f"âœ… åˆ›å»ºç¤ºä¾‹ç¨‹åº: {example_path}")

    def _create_cmake_config(self, project_dir: Path, project_name: str):
        """åˆ›å»ºCMakeé…ç½® - ç®€åŒ–ç‰ˆæœ¬"""
        cmake_content = f'''cmake_minimum_required(VERSION 3.16)
project({project_name} VERSION 1.0.0 LANGUAGES CXX)

# C++æ ‡å‡†è®¾ç½®
set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

# åŒ…å«ç›®å½•
include_directories(include)

# ä¸»ç¨‹åº
add_executable(${{PROJECT_NAME}} src/main.cpp)

# ç¤ºä¾‹ç¨‹åº
add_executable(${{PROJECT_NAME}}_example examples/basic/simple_example.cpp)

# æµ‹è¯•ç¨‹åº
if(EXISTS ${{CMAKE_CURRENT_SOURCE_DIR}}/tests/simple_test.cpp)
    add_executable(${{PROJECT_NAME}}_test tests/simple_test.cpp)

    # å¯ç”¨æµ‹è¯•
    enable_testing()
    add_test(NAME BasicTest COMMAND ${{PROJECT_NAME}}_test)
endif()

# è®¾ç½®è¾“å‡ºç›®å½•
set_target_properties(${{PROJECT_NAME}} PROPERTIES
    RUNTIME_OUTPUT_DIRECTORY "${{CMAKE_BINARY_DIR}}/bin"
)
set_target_properties(${{PROJECT_NAME}}_example PROPERTIES
    RUNTIME_OUTPUT_DIRECTORY "${{CMAKE_BINARY_DIR}}/bin"
)

# ç¼–è¯‘é€‰é¡¹
if(MSVC)
    target_compile_options(${{PROJECT_NAME}} PRIVATE /W4)
    target_compile_options(${{PROJECT_NAME}}_example PRIVATE /W4)
else()
    target_compile_options(${{PROJECT_NAME}} PRIVATE -Wall -Wextra -Wpedantic)
    target_compile_options(${{PROJECT_NAME}}_example PRIVATE -Wall -Wextra -Wpedantic)
endif()

# å®‰è£…é…ç½®
install(TARGETS ${{PROJECT_NAME}} ${{PROJECT_NAME}}_example
    RUNTIME DESTINATION bin
)

message(STATUS "é…ç½® {project_name} é¡¹ç›®å®Œæˆ")
message(STATUS "ä¸»ç¨‹åº: ${{PROJECT_NAME}}")
message(STATUS "ç¤ºä¾‹ç¨‹åº: ${{PROJECT_NAME}}_example")
'''

        cmake_path = project_dir / "CMakeLists.txt"
        cmake_path.write_text(cmake_content, encoding='utf-8')
        print(f"âœ… åˆ›å»ºCMakeé…ç½®: {cmake_path}")

    def _create_test_files(self, project_dir: Path, project_name: str):
        """åˆ›å»ºæµ‹è¯•æ–‡ä»¶"""
        test_content = f'''/**
 * @file simple_test.cpp
 * @brief {project_name} - ç®€å•æµ‹è¯•ç¨‹åº
 */

#include "netbox/NetBox.h"
#include <cassert>

void test_version() {{
    std::cout << "ğŸ§ª æµ‹è¯•ç‰ˆæœ¬ä¿¡æ¯..." << std::endl;
    assert(NetBox::Version::MAJOR == 1);
    assert(NetBox::Version::MINOR == 0);
    assert(NetBox::Version::PATCH == 0);
    std::cout << "âœ… ç‰ˆæœ¬æµ‹è¯•é€šè¿‡" << std::endl;
}}

void test_application() {{
    std::cout << "ğŸ§ª æµ‹è¯•åº”ç”¨ç¨‹åº..." << std::endl;
    NetBox::Application app("TestApp");
    assert(app.getName() == "TestApp");
    assert(app.initialize() == true);
    assert(app.start() == true);
    app.stop();
    std::cout << "âœ… åº”ç”¨ç¨‹åºæµ‹è¯•é€šè¿‡" << std::endl;
}}

void test_framework() {{
    std::cout << "ğŸ§ª æµ‹è¯•æ¡†æ¶åˆå§‹åŒ–..." << std::endl;
    assert(NETBOX_INIT() == true);
    NETBOX_CLEANUP();
    std::cout << "âœ… æ¡†æ¶æµ‹è¯•é€šè¿‡" << std::endl;
}}

int main() {{
    std::cout << "ğŸš€ å¼€å§‹ {project_name} æµ‹è¯•" << std::endl;
    std::cout << "=========================" << std::endl;

    try {{
        test_version();
        test_application();
        test_framework();

        std::cout << "=========================" << std::endl;
        std::cout << "ğŸ‰ æ‰€æœ‰æµ‹è¯•é€šè¿‡!" << std::endl;
        return 0;

    }} catch (const std::exception& e) {{
        std::cerr << "âŒ æµ‹è¯•å¤±è´¥: " << e.what() << std::endl;
        return 1;
    }}
}}
'''

        test_path = project_dir / "tests" / "simple_test.cpp"
        test_path.write_text(test_content, encoding='utf-8')
        print(f"âœ… åˆ›å»ºæµ‹è¯•æ–‡ä»¶: {test_path}")

    def _create_readme(self, project_dir: Path, project_name: str):
        """åˆ›å»ºREADMEæ–‡ä»¶"""
        readme_content = f'''# {project_name}

> åŸºäºNetBoxæ¡†æ¶çš„é¡¹ç›®

## å¿«é€Ÿå¼€å§‹

### æ„å»ºé¡¹ç›®

```bash
mkdir build && cd build
cmake ..
make
```

### è¿è¡Œç¨‹åº

```bash
# è¿è¡Œä¸»ç¨‹åº
./bin/{project_name}

# è¿è¡Œç¤ºä¾‹ç¨‹åº
./bin/{project_name}_example

# è¿è¡Œæµ‹è¯•
./bin/{project_name}_test
# æˆ–ä½¿ç”¨ctest
ctest
```

## é¡¹ç›®ç»“æ„

```
{project_name}/
â”œâ”€â”€ src/                    # æºä»£ç 
â”‚   â””â”€â”€ main.cpp           # ä¸»ç¨‹åº
â”œâ”€â”€ include/netbox/        # å¤´æ–‡ä»¶
â”‚   â””â”€â”€ NetBox.h          # æ¡†æ¶å¤´æ–‡ä»¶
â”œâ”€â”€ examples/basic/        # ç¤ºä¾‹ä»£ç 
â”‚   â””â”€â”€ simple_example.cpp # ç®€å•ç¤ºä¾‹
â”œâ”€â”€ tests/                 # æµ‹è¯•ä»£ç 
â”‚   â””â”€â”€ simple_test.cpp   # åŸºç¡€æµ‹è¯•
â”œâ”€â”€ docs/                  # æ–‡æ¡£
â”œâ”€â”€ config/               # é…ç½®æ–‡ä»¶
â””â”€â”€ CMakeLists.txt        # æ„å»ºé…ç½®
```

## å¼€å‘æŒ‡å—

### æ·»åŠ æ–°åŠŸèƒ½

1. åœ¨ `src/` ç›®å½•ä¸‹æ·»åŠ æºæ–‡ä»¶
2. åœ¨ `include/netbox/` ç›®å½•ä¸‹æ·»åŠ å¤´æ–‡ä»¶
3. æ›´æ–° `CMakeLists.txt`
4. ç¼–å†™æµ‹è¯•ç”¨ä¾‹

### æ‰©å±•åº”ç”¨

ç»§æ‰¿ `NetBox::Application` ç±»æ¥åˆ›å»ºè‡ªå®šä¹‰åº”ç”¨ï¼š

```cpp
class MyApp : public NetBox::Application {{
public:
    MyApp() : NetBox::Application("MyApp") {{}}

    bool initialize() override {{
        // åˆå§‹åŒ–é€»è¾‘
        return true;
    }}

    bool start() override {{
        // å¯åŠ¨é€»è¾‘
        return true;
    }}
}};
```

## æ„å»ºé€‰é¡¹

```bash
# Debugæ„å»º
cmake .. -DCMAKE_BUILD_TYPE=Debug

# Releaseæ„å»º
cmake .. -DCMAKE_BUILD_TYPE=Release

# å¹¶è¡Œæ„å»º
make -j$(nproc)
```

## ç‰ˆæœ¬ä¿¡æ¯

- é¡¹ç›®ç‰ˆæœ¬: 1.0.0
- NetBoxç‰ˆæœ¬: 1.0.0
- C++æ ‡å‡†: C++17

---

*ç”±NetBox CLI v2.0ç”Ÿæˆ*
'''

        readme_path = project_dir / "README.md"
        readme_path.write_text(readme_content, encoding='utf-8')
        print(f"âœ… åˆ›å»ºREADME: {readme_path}")

    # ==================== CLIå‘½ä»¤å¤„ç† ====================

    def cmd_init(self, args):
        """åˆå§‹åŒ–æ–°é¡¹ç›®"""
        project_name = args.name or self.config["project"]["default_name"]
        project_dir = Path(project_name)

        if project_dir.exists():
            print(f"âŒ ç›®å½• {project_name} å·²å­˜åœ¨")
            return False

        # æ˜¾ç¤ºé¡¹ç›®åˆ›å»ºåŠ¨ç”»
        try:
            show_project_creation_animation(project_name)
        except:
            print(f"ğŸš€ åˆ›å»ºNetBoxé¡¹ç›®: {project_name}")
            print("=" * 50)

        # åˆ›å»ºç›®å½•ç»“æ„
        print("ğŸ“ åˆ›å»ºç›®å½•ç»“æ„...")
        if not self.create_directory_structure(project_dir):
            return False

        # åˆ›å»ºåŸºç¡€æ–‡ä»¶
        print("ğŸ“ åˆ›å»ºé¡¹ç›®æ–‡ä»¶...")
        if not self.create_basic_files(project_dir, project_name):
            return False

        print("=" * 50)
        print(f"âœ… é¡¹ç›® {project_name} åˆ›å»ºæˆåŠŸ!")
        print(f"ğŸ“ é¡¹ç›®ç›®å½•: {project_dir.absolute()}")
        print()
        print("ğŸ”§ ä¸‹ä¸€æ­¥:")
        print(f"   cd {project_name}")
        print("   mkdir build && cd build")
        print("   cmake ..")
        print("   make")
        print(f"   ./bin/{project_name}")

        return True

    def cmd_build(self, args):
        """æ„å»ºé¡¹ç›®"""
        build_type = args.type or self.config["build"]["default_type"]
        jobs = args.jobs or self.config["build"]["parallel_jobs"]

        # æ˜¾ç¤ºæ„å»ºåŠ¨ç”»
        try:
            print(f"\n{Colors.BOLD}{Colors.BRIGHT_MAGENTA}æ„å»ºé¡¹ç›®: {Path.cwd().name}{Colors.RESET}")
            Animations.fade_in_logo(ASCIIArt.FRAMEWORK_TITLE, ASCIIArt.get_gradient_colors(), 0.03)
        except:
            print(f"ğŸ”¨ æ„å»ºé¡¹ç›® ({build_type})")

        # æ£€æŸ¥æ˜¯å¦åœ¨é¡¹ç›®ç›®å½•ä¸­
        if not Path("CMakeLists.txt").exists():
            print("âŒ æœªæ‰¾åˆ°CMakeLists.txtï¼Œè¯·åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸­è¿è¡Œ")
            return False

        # åˆ›å»ºæ„å»ºç›®å½•
        build_dir = Path("build")
        build_dir.mkdir(exist_ok=True)

        # é…ç½®é¡¹ç›®
        try:
            print(f"\n{Colors.BRIGHT_YELLOW}âš™ï¸  é…ç½®é¡¹ç›®...{Colors.RESET}")
            Animations.spinning_loader("é…ç½®CMakeé¡¹ç›®", 1.0)
        except:
            print("âš™ï¸  é…ç½®é¡¹ç›®...")

        # Windowsç‰¹æ®Šå¤„ç†
        cmake_config_cmd = ["cmake", ".."]
        if self.detect_platform() != "windows":
            cmake_config_cmd.append(f"-DCMAKE_BUILD_TYPE={build_type}")

        if not self.run_command(cmake_config_cmd, cwd=build_dir):
            print("âŒ CMakeé…ç½®å¤±è´¥")
            if self.detect_platform() == "windows":
                print("\nğŸ’¡ Windowså¸¸è§è§£å†³æ–¹æ¡ˆ:")
                print("   1. å®‰è£…Visual Studio Community (å…è´¹)")
                print("   2. ç¡®ä¿å®‰è£…äº†C++æ„å»ºå·¥å…·")
                print("   3. è¿è¡Œæ•…éšœæ’é™¤è„šæœ¬: windows_troubleshoot.bat")
                print("   4. æ£€æŸ¥è·¯å¾„æ˜¯å¦åŒ…å«ä¸­æ–‡å­—ç¬¦")
            return False

        # æ„å»ºé¡¹ç›®
        try:
            print(f"\n{Colors.BRIGHT_CYAN}ğŸ”§ æ„å»ºé¡¹ç›® (ä½¿ç”¨{jobs}ä¸ªå¹¶è¡Œä»»åŠ¡)...{Colors.RESET}")
            
            # æ„å»ºæ­¥éª¤åŠ¨ç”»
            build_steps = [
                "ç¼–è¯‘æ ¸å¿ƒæ¡†æ¶",
                "é“¾æ¥åº“æ–‡ä»¶", 
                "ç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶",
                "è¿è¡Œæµ‹è¯•",
                "å®Œæˆæ„å»º"
            ]
            
            styles = ["blocks", "gradient", "circles", "squares"]
            selected_style = random.choice(styles)
            Animations.progress_bar("ğŸ”¨ æ„å»ºè¿›åº¦", build_steps, 0.8, selected_style)
            
        except:
            print(f"ğŸ”§ æ„å»ºé¡¹ç›® (ä½¿ç”¨{jobs}ä¸ªå¹¶è¡Œä»»åŠ¡)...")

        # ä½¿ç”¨cmake --buildå‘½ä»¤ï¼Œè·¨å¹³å°å…¼å®¹
        build_cmd = ["cmake", "--build", ".", "--parallel", str(jobs)]

        # Windowsä¸‹æŒ‡å®šé…ç½®ç±»å‹
        if self.detect_platform() == "windows":
            build_cmd.extend(["--config", build_type])

        if not self.run_command(build_cmd, cwd=build_dir):
            print("âŒ æ„å»ºå¤±è´¥")
            if self.detect_platform() == "windows":
                print("\nğŸ’¡ Windowsæ„å»ºå¤±è´¥è§£å†³æ–¹æ¡ˆ:")
                print("   1. ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œå‘½ä»¤")
                print("   2. æ£€æŸ¥æ€æ¯’è½¯ä»¶æ˜¯å¦é˜»æ­¢ç¼–è¯‘")
                print("   3. ç¡®ä¿æœ‰è¶³å¤Ÿçš„ç£ç›˜ç©ºé—´")
                print("   4. å°è¯•æ¸…ç†åé‡æ–°æ„å»º: netbox clean && netbox build")
            return False

        # æˆåŠŸåŠ¨ç”»
        try:
            print(f"\n{Colors.BRIGHT_GREEN}{'ğŸ‰' * 15}{Colors.RESET}")
            Animations.typewriter_effect(
                "âœ… æ„å»ºæˆåŠŸ!", 
                0.05, 
                Colors.BRIGHT_GREEN
            )
            print(f"{Colors.BRIGHT_GREEN}{'ğŸ‰' * 15}{Colors.RESET}\n")
        except:
            print("âœ… æ„å»ºæˆåŠŸ!")

        # æ ¹æ®å¹³å°æ˜¾ç¤ºå¯æ‰§è¡Œæ–‡ä»¶ä½ç½®
        if self.detect_platform() == "windows":
            print(f"ğŸ¯ å¯æ‰§è¡Œæ–‡ä»¶ä½äº build/{build_type}/ ç›®å½•")
        else:
            print("ğŸ¯ å¯æ‰§è¡Œæ–‡ä»¶ä½äº build/bin/ ç›®å½•")

        return True

    def cmd_test(self, args):
        """è¿è¡Œæµ‹è¯•"""
        build_dir = Path("build")

        if not build_dir.exists():
            print("âŒ æ„å»ºç›®å½•ä¸å­˜åœ¨ï¼Œè¯·å…ˆè¿è¡Œ: netbox build")
            return False

        # æ˜¾ç¤ºæµ‹è¯•åŠ¨ç”»
        try:
            print(f"\n{Colors.BOLD}{Colors.BRIGHT_MAGENTA}è¿è¡Œæµ‹è¯•: {Path.cwd().name}{Colors.RESET}")
            Animations.spinning_loader("åˆå§‹åŒ–æµ‹è¯•ç¯å¢ƒ", 1.0)
        except:
            print("ğŸ§ª è¿è¡Œæµ‹è¯•...")

        # ä½¿ç”¨ctestè¿è¡Œæµ‹è¯•
        if (build_dir / "CTestTestfile.cmake").exists():
            return self.run_command(["ctest", "--verbose"], cwd=build_dir)
        else:
            # ç›´æ¥è¿è¡Œæµ‹è¯•å¯æ‰§è¡Œæ–‡ä»¶
            test_files = list(build_dir.glob("bin/*_test*"))
            if test_files:
                for test_file in test_files:
                    try:
                        print(f"\n{Colors.BRIGHT_CYAN}ğŸƒ è¿è¡Œæµ‹è¯•: {test_file.name}{Colors.RESET}")
                        Animations.spinning_loader(f"æ‰§è¡Œ {test_file.name}", 0.5)
                    except:
                        print(f"ğŸƒ è¿è¡Œæµ‹è¯•: {test_file.name}")
                    
                    if not self.run_command([str(test_file)]):
                        return False
                return True
            else:
                print("âŒ æœªæ‰¾åˆ°æµ‹è¯•ç¨‹åº")
                return False

    def cmd_run(self, args):
        """è¿è¡Œç¨‹åº"""
        build_dir = Path("build")

        if not build_dir.exists():
            print("âŒ æ„å»ºç›®å½•ä¸å­˜åœ¨ï¼Œè¯·å…ˆè¿è¡Œ: netbox build")
            return False

        # æ˜¾ç¤ºè¿è¡ŒåŠ¨ç”»
        try:
            print(f"\n{Colors.BOLD}{Colors.BRIGHT_MAGENTA}å¯åŠ¨ç¨‹åº: {Path.cwd().name}{Colors.RESET}")
            Animations.fade_in_logo(ASCIIArt.NETBOX_SUBTITLE, [Colors.BRIGHT_GREEN], 0.05)
        except:
            print("ğŸš€ å¯åŠ¨ç¨‹åº...")

        # æ ¹æ®å¹³å°æŸ¥æ‰¾å¯æ‰§è¡Œæ–‡ä»¶
        exe_files = []
        if self.detect_platform() == "windows":
            exe_files = list(build_dir.glob(f"**/*.exe"))
        else:
            exe_files = list(build_dir.glob("bin/*"))

        if not exe_files:
            print("âŒ æœªæ‰¾åˆ°å¯æ‰§è¡Œæ–‡ä»¶")
            return False

        # é€‰æ‹©è¦è¿è¡Œçš„ç¨‹åº
        target = args.target
        if target:
            # æŸ¥æ‰¾æŒ‡å®šçš„ç›®æ ‡
            target_files = [f for f in exe_files if target in f.name]
            if target_files:
                exe_file = target_files[0]
            else:
                print(f"âŒ æœªæ‰¾åˆ°ç›®æ ‡ç¨‹åº: {target}")
                return False
        else:
            # é€‰æ‹©ç¬¬ä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶
            exe_file = exe_files[0]

        try:
            print(f"\n{Colors.BRIGHT_GREEN}ğŸŒŸ å¯åŠ¨: {exe_file.name}{Colors.RESET}")
            Animations.spinning_loader("å¯åŠ¨åº”ç”¨ç¨‹åº", 1.0)
        except:
            print(f"ğŸŒŸ å¯åŠ¨: {exe_file.name}")

        # è¿è¡Œç¨‹åº
        return self.run_command([str(exe_file)], cwd=build_dir.parent)

    def cmd_info(self, args):
        """æ˜¾ç¤ºé¡¹ç›®ä¿¡æ¯"""
        print("ğŸ“‹ NetBox CLI v2.0 ä¿¡æ¯")
        print("=" * 40)
        print(f"ç‰ˆæœ¬: {self.version}")
        print(f"å¹³å°: {self.detect_platform()}")
        print(f"æ ¹ç›®å½•: {self.root_dir}")
        print(f"Python: {sys.version.split()[0]}")

        # æ£€æŸ¥ä¾èµ–
        print("\nğŸ”§ ç³»ç»Ÿä¾èµ–:")
        deps = ["cmake", "make", "g++", "clang++"]
        for dep in deps:
            try:
                result = subprocess.run([dep, "--version"],
                                      capture_output=True, text=True)
                if result.returncode == 0:
                    version = result.stdout.split('\n')[0]
                    print(f"  âœ… {dep}: {version}")
                else:
                    print(f"  âŒ {dep}: æœªå®‰è£…")
            except FileNotFoundError:
                print(f"  âŒ {dep}: æœªæ‰¾åˆ°")

        return True

    def cmd_clean(self, args):
        """æ¸…ç†æ„å»ºæ–‡ä»¶"""
        build_dir = Path("build")

        if not build_dir.exists():
            print("âœ… æ„å»ºç›®å½•ä¸å­˜åœ¨ï¼Œæ— éœ€æ¸…ç†")
            return True

        print("ğŸ§¹ æ¸…ç†æ„å»ºæ–‡ä»¶...")
        try:
            import shutil
            shutil.rmtree(build_dir)
            print("âœ… æ¸…ç†å®Œæˆ")
            return True
        except Exception as e:
            print(f"âŒ æ¸…ç†å¤±è´¥: {e}")
            return False

    def main(self):
        """ä¸»å‡½æ•°"""
        # æ£€æŸ¥æ˜¯å¦éœ€è¦æ˜¾ç¤ºå¯åŠ¨åŠ¨ç”»
        show_animation = len(sys.argv) > 1 and sys.argv[1] not in ['--help', '-h', '--version']

        if show_animation:
            try:
                show_startup_animation()
            except:
                show_simple_banner()

        parser = argparse.ArgumentParser(
            description="NetBox CLI v2.0 - ç®€åŒ–ã€å¯é çš„è„šæ‰‹æ¶å·¥å…·",
            formatter_class=argparse.RawDescriptionHelpFormatter,
            epilog="""
ç¤ºä¾‹:
  netbox init MyProject     # åˆ›å»ºæ–°é¡¹ç›®
  netbox build             # æ„å»ºé¡¹ç›®
  netbox test              # è¿è¡Œæµ‹è¯•
  netbox run               # è¿è¡Œç¨‹åº
  netbox info              # æ˜¾ç¤ºä¿¡æ¯
  netbox clean             # æ¸…ç†æ„å»ºæ–‡ä»¶
            """
        )

        parser.add_argument('--version', action='version',
                          version=f'NetBox CLI v{self.version}')

        subparsers = parser.add_subparsers(dest='command', help='å¯ç”¨å‘½ä»¤')

        # initå‘½ä»¤
        init_parser = subparsers.add_parser('init', help='åˆ›å»ºæ–°é¡¹ç›®')
        init_parser.add_argument('name', nargs='?', help='é¡¹ç›®åç§°')

        # buildå‘½ä»¤
        build_parser = subparsers.add_parser('build', help='æ„å»ºé¡¹ç›®')
        build_parser.add_argument('--type', choices=['Debug', 'Release'],
                                help='æ„å»ºç±»å‹')
        build_parser.add_argument('--jobs', type=int, help='å¹¶è¡Œä»»åŠ¡æ•°')

        # testå‘½ä»¤
        subparsers.add_parser('test', help='è¿è¡Œæµ‹è¯•')

        # runå‘½ä»¤
        run_parser = subparsers.add_parser('run', help='è¿è¡Œç¨‹åº')
        run_parser.add_argument('target', nargs='?', help='ç›®æ ‡ç¨‹åº')

        # infoå‘½ä»¤
        subparsers.add_parser('info', help='æ˜¾ç¤ºé¡¹ç›®ä¿¡æ¯')

        # cleanå‘½ä»¤
        subparsers.add_parser('clean', help='æ¸…ç†æ„å»ºæ–‡ä»¶')

        args = parser.parse_args()

        if not args.command:
            parser.print_help()
            return 1

        # æ‰§è¡Œå‘½ä»¤
        command_map = {
            'init': self.cmd_init,
            'build': self.cmd_build,
            'test': self.cmd_test,
            'run': self.cmd_run,
            'info': self.cmd_info,
            'clean': self.cmd_clean
        }

        if args.command in command_map:
            try:
                success = command_map[args.command](args)
                return 0 if success else 1
            except KeyboardInterrupt:
                print("\nâš ï¸  æ“ä½œè¢«ç”¨æˆ·ä¸­æ–­")
                return 1
            except Exception as e:
                print(f"âŒ æ‰§è¡Œå¤±è´¥: {e}")
                return 1
        else:
            print(f"âŒ æœªçŸ¥å‘½ä»¤: {args.command}")
            return 1

if __name__ == "__main__":
    cli = NetBoxCLI()
    sys.exit(cli.main())
