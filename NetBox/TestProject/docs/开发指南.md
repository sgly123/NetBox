# ğŸ”§ TestProject å¼€å‘æŒ‡å—

æ¬¢è¿ä½¿ç”¨NetBoxæ¡†æ¶è¿›è¡ŒäºŒæ¬¡å¼€å‘ï¼æœ¬æŒ‡å—å°†å¸®åŠ©ä½ å¿«é€Ÿä¸Šæ‰‹æ¡†æ¶çš„æ‰©å±•å¼€å‘ã€‚

## ğŸ“‹ **æ¡†æ¶æ¶æ„**

TestProjectåŸºäºNetBoxæ¡†æ¶æ„å»ºï¼Œé‡‡ç”¨åˆ†å±‚æ¶æ„è®¾è®¡ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    åº”ç”¨å±‚ (Application Layer)                â”‚
â”‚  - Webåº”ç”¨  - æ¸¸æˆåº”ç”¨  - å¾®æœåŠ¡åº”ç”¨  - è‡ªå®šä¹‰åº”ç”¨           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    åè®®å±‚ (Protocol Layer)                   â”‚
â”‚  - HTTPåè®®  - WebSocket  - è‡ªå®šä¹‰åè®®  - æ¶ˆæ¯ç¼–è§£ç          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    ç½‘ç»œå±‚ (Network Layer)                    â”‚
â”‚  - ä¼ è¾“å±‚æŠ½è±¡  - è¿æ¥ç®¡ç†  - è´Ÿè½½å‡è¡¡  - ç½‘ç»œä¼˜åŒ–           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    æ’ä»¶å±‚ (Plugin Layer)                     â”‚
â”‚  - è®¤è¯æ’ä»¶  - ç¼“å­˜æ’ä»¶  - æ•°æ®åº“æ’ä»¶  - ç›‘æ§æ’ä»¶           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    æ ¸å¿ƒå±‚ (Core Layer)                       â”‚
â”‚  - äº‹ä»¶å¾ªç¯  - çº¿ç¨‹æ±   - å†…å­˜ç®¡ç†  - é…ç½®ç®¡ç†               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸš€ **å¿«é€Ÿå¼€å§‹**

### **1. æ„å»ºæ¡†æ¶**
```bash
cd TestProject
mkdir build && cd build
cmake ..
make -j$(nproc)
```

### **2. è¿è¡Œç¤ºä¾‹**
```bash
# åŸºç¡€TCPæœåŠ¡å™¨ç¤ºä¾‹
./examples/simple_server

# è‡ªå®šä¹‰åè®®ç¤ºä¾‹
./examples/custom_protocol
```

### **3. è¿è¡Œæµ‹è¯•**
```bash
make test
```

---

## ğŸ”Œ **åè®®å±‚äºŒæ¬¡å¼€å‘**

### **å®ç°è‡ªå®šä¹‰åè®®**

1. **ç»§æ‰¿MessageåŸºç±»**
```cpp
class MyMessage : public NetBox::Protocol::Message {
    // å®ç°åºåˆ—åŒ–å’Œååºåˆ—åŒ–
    std::vector<uint8_t> serialize() const override;
    bool deserialize(const std::vector<uint8_t>& data) override;
};
```

2. **å®ç°Codecç¼–è§£ç å™¨**
```cpp
class MyCodec : public NetBox::Protocol::Codec {
    std::vector<uint8_t> encode(const Message& message) override;
    bool decode(const std::vector<uint8_t>& data, std::unique_ptr<Message>& message) override;
    int checkIntegrity(const std::vector<uint8_t>& data) override;
};
```

3. **å®ç°ProtocolHandlerå¤„ç†å™¨**
```cpp
class MyProtocolHandler : public NetBox::Protocol::ProtocolHandler {
    void onMessage(std::shared_ptr<Message> message) override;
    void onConnect() override;
    void onDisconnect() override;
};
```

4. **åˆ›å»ºProtocolFactoryå·¥å‚**
```cpp
class MyProtocolFactory : public NetBox::Protocol::ProtocolFactory {
    std::unique_ptr<Codec> createCodec() override;
    std::unique_ptr<ProtocolHandler> createHandler() override;
    std::string getProtocolName() const override;
};
```

### **åè®®æ‰©å±•ç¤ºä¾‹**

å‚è€ƒ `examples/custom_protocol/custom_protocol.cpp` æŸ¥çœ‹å®Œæ•´çš„è‡ªå®šä¹‰åè®®å®ç°ã€‚

---

## ğŸ¯ **åº”ç”¨å±‚äºŒæ¬¡å¼€å‘**

### **Webåº”ç”¨å¼€å‘**

1. **ç»§æ‰¿WebApplication**
```cpp
class MyWebApp : public NetBox::Application::WebApplication {
public:
    MyWebApp() : WebApplication("MyWebApp") {}

    bool initialize() override {
        // è®¾ç½®è·¯ç”±
        addRoute("GET", "/api/users", [](auto ctx) {
            ctx->send("{\"users\": []}");
        });

        // è®¾ç½®é™æ€æ–‡ä»¶æœåŠ¡
        serveStatic("/static", "./public");

        return true;
    }
};
```

2. **è‡ªå®šä¹‰ä¸­é—´ä»¶**
```cpp
addMiddleware([](std::shared_ptr<Context> ctx) -> bool {
    // è®¤è¯ä¸­é—´ä»¶
    std::string token = ctx->getAttribute("Authorization");
    if (token.empty()) {
        ctx->send("HTTP/1.1 401 Unauthorized\r\n\r\n");
        return false; // é˜»æ­¢ç»§ç»­å¤„ç†
    }
    return true; // ç»§ç»­å¤„ç†
});
```

### **æ¸¸æˆåº”ç”¨å¼€å‘**

1. **ç»§æ‰¿GameApplication**
```cpp
class MyGameServer : public NetBox::Application::GameApplication {
public:
    MyGameServer() : GameApplication("MyGameServer") {}

    void onPlayerJoin(std::shared_ptr<Context> ctx) override {
        std::string playerId = generatePlayerId();
        ctx->setAttribute("playerId", playerId);
        broadcastMessage("Player " + playerId + " joined");
    }

    void onGameMessage(std::shared_ptr<Context> ctx, const std::string& message) override {
        // å¤„ç†æ¸¸æˆæ¶ˆæ¯
        processGameLogic(ctx, message);
    }
};
```

---

## ğŸŒ **ç½‘ç»œå±‚äºŒæ¬¡å¼€å‘**

### **è‡ªå®šä¹‰ä¼ è¾“å±‚**

1. **å®ç°Transportæ¥å£**
```cpp
class MyTransport : public NetBox::Network::Transport {
public:
    bool bind(const std::string& address, int port) override;
    bool listen(int backlog) override;
    std::shared_ptr<Transport> accept() override;
    int send(const std::vector<uint8_t>& data) override;
    int receive(std::vector<uint8_t>& data) override;
};
```

### **ç½‘ç»œä¼˜åŒ–å™¨**

1. **å®ç°Optimizeræ¥å£**
```cpp
class MyOptimizer : public NetBox::Network::Optimizer {
public:
    void optimizeConnection(std::shared_ptr<Transport> transport) override {
        // è®¾ç½®TCP_NODELAY
        transport->setOption("TCP_NODELAY", "1");

        // è®¾ç½®ç¼“å†²åŒºå¤§å°
        transport->setOption("SO_RCVBUF", "65536");
        transport->setOption("SO_SNDBUF", "65536");
    }

    void optimizeTransfer(std::vector<uint8_t>& data) override {
        // æ•°æ®å‹ç¼©
        compressData(data);
    }
};
```

### **è´Ÿè½½å‡è¡¡å™¨**

1. **å®ç°LoadBalanceræ¥å£**
```cpp
class MyLoadBalancer : public NetBox::Network::LoadBalancer {
private:
    std::vector<Backend> m_backends;
    size_t m_currentIndex = 0;

public:
    std::pair<std::string, int> selectBackend() override {
        // è½®è¯¢ç®—æ³•
        if (m_backends.empty()) return {"", 0};

        auto& backend = m_backends[m_currentIndex];
        m_currentIndex = (m_currentIndex + 1) % m_backends.size();

        return {backend.address, backend.port};
    }
};
```

---

## ğŸ”Œ **æ’ä»¶ç³»ç»Ÿå¼€å‘**

### **è®¤è¯æ’ä»¶**

```cpp
class JWTAuthPlugin : public NetBox::Plugins::AuthPlugin {
public:
    std::string getName() const override { return "JWTAuth"; }
    std::string getVersion() const override { return "1.0.0"; }

    bool authenticate(const std::string& username, const std::string& password) override {
        // éªŒè¯ç”¨æˆ·åå¯†ç 
        return validateCredentials(username, password);
    }

    std::string generateToken(const std::string& username) override {
        // ç”ŸæˆJWTä»¤ç‰Œ
        return createJWTToken(username);
    }

    bool validateToken(const std::string& token) override {
        // éªŒè¯JWTä»¤ç‰Œ
        return verifyJWTToken(token);
    }
};
```

### **ç¼“å­˜æ’ä»¶**

```cpp
class RedisCache : public NetBox::Plugins::CachePlugin {
private:
    RedisConnection m_redis;

public:
    bool initialize() override {
        return m_redis.connect("localhost:6379");
    }

    bool set(const std::string& key, const std::string& value, int ttl) override {
        if (ttl > 0) {
            return m_redis.setex(key, ttl, value);
        } else {
            return m_redis.set(key, value);
        }
    }

    std::string get(const std::string& key) override {
        return m_redis.get(key);
    }
};
```

---

## ğŸ“Š **æ€§èƒ½ä¼˜åŒ–æŒ‡å—**

### **1. ç½‘ç»œå±‚ä¼˜åŒ–**
- ä½¿ç”¨åˆé€‚çš„IOå¤šè·¯å¤ç”¨æ¨¡å‹ (EPOLL/KQUEUE/IOCP)
- è°ƒæ•´TCPå‚æ•° (TCP_NODELAY, SO_REUSEPORT)
- å®ç°è¿æ¥æ± å’Œå¯¹è±¡æ± 
- ä½¿ç”¨é›¶æ‹·è´æŠ€æœ¯

### **2. åè®®å±‚ä¼˜åŒ–**
- è®¾è®¡é«˜æ•ˆçš„åºåˆ—åŒ–æ ¼å¼
- å®ç°æ¶ˆæ¯å‹ç¼©
- ä½¿ç”¨æ‰¹é‡å¤„ç†
- é¿å…é¢‘ç¹çš„å†…å­˜åˆ†é…

### **3. åº”ç”¨å±‚ä¼˜åŒ–**
- å¼‚æ­¥å¤„ç†é•¿æ—¶é—´æ“ä½œ
- å®ç°è¯·æ±‚ç¼“å­˜
- ä½¿ç”¨æ•°æ®åº“è¿æ¥æ± 
- ä¼˜åŒ–ä¸šåŠ¡é€»è¾‘

---

## ğŸ§ª **æµ‹è¯•æŒ‡å—**

### **å•å…ƒæµ‹è¯•**
```cpp
#include <gtest/gtest.h>
#include "MyProtocol.h"

TEST(MyProtocolTest, MessageSerialization) {
    MyMessage msg;
    msg.setData("test data");

    auto serialized = msg.serialize();
    EXPECT_GT(serialized.size(), 0);

    MyMessage decoded;
    EXPECT_TRUE(decoded.deserialize(serialized));
    EXPECT_EQ(decoded.getData(), msg.getData());
}
```

### **é›†æˆæµ‹è¯•**
```cpp
TEST(IntegrationTest, ServerClientCommunication) {
    // å¯åŠ¨æœåŠ¡å™¨
    MyServer server;
    ASSERT_TRUE(server.start("localhost", 8080));

    // è¿æ¥å®¢æˆ·ç«¯
    MyClient client;
    ASSERT_TRUE(client.connect("localhost", 8080));

    // å‘é€æ¶ˆæ¯
    client.send("Hello Server");

    // éªŒè¯å“åº”
    auto response = client.receive();
    EXPECT_EQ(response, "Hello Client");
}
```

---

## ğŸ“š **APIå‚è€ƒ**

### **æ ¸å¿ƒç±»**
- `NetBox::Framework` - æ¡†æ¶ä¸»ç±»
- `NetBox::EventLoop` - äº‹ä»¶å¾ªç¯
- `NetBox::ThreadPool` - çº¿ç¨‹æ± 

### **ç½‘ç»œç±»**
- `NetBox::Network::Transport` - ä¼ è¾“å±‚æ¥å£
- `NetBox::Network::Connection` - è¿æ¥ç®¡ç†
- `NetBox::Network::Server` - æœåŠ¡å™¨åŸºç±»

### **åè®®ç±»**
- `NetBox::Protocol::Message` - æ¶ˆæ¯åŸºç±»
- `NetBox::Protocol::Codec` - ç¼–è§£ç å™¨æ¥å£
- `NetBox::Protocol::ProtocolHandler` - åè®®å¤„ç†å™¨

### **åº”ç”¨ç±»**
- `NetBox::Application::Application` - åº”ç”¨åŸºç±»
- `NetBox::Application::WebApplication` - Webåº”ç”¨åŸºç±»
- `NetBox::Application::GameApplication` - æ¸¸æˆåº”ç”¨åŸºç±»

---

## ğŸ¤ **è´¡çŒ®æŒ‡å—**

1. **Forké¡¹ç›®**
2. **åˆ›å»ºç‰¹æ€§åˆ†æ”¯** (`git checkout -b feature/AmazingFeature`)
3. **æäº¤æ›´æ”¹** (`git commit -m 'Add some AmazingFeature'`)
4. **æ¨é€åˆ†æ”¯** (`git push origin feature/AmazingFeature`)
5. **åˆ›å»ºPull Request**

---

## ğŸ“„ **è®¸å¯è¯**

æœ¬é¡¹ç›®é‡‡ç”¨MITè®¸å¯è¯ - æŸ¥çœ‹ [LICENSE](LICENSE) æ–‡ä»¶äº†è§£è¯¦æƒ…ã€‚

---

## ğŸ†˜ **è·å–å¸®åŠ©**

- ğŸ“– æŸ¥çœ‹ [APIæ–‡æ¡£](api/README.md)
- ğŸ’¬ åŠ å…¥ [è®¨è®ºåŒº](https://github.com/TestProject/discussions)
- ğŸ› æŠ¥å‘Š [é—®é¢˜](https://github.com/TestProject/issues)
- ğŸ“§ è”ç³»ç»´æŠ¤è€…: developer@netbox.com

---

**å¼€å§‹ä½ çš„NetBoxäºŒæ¬¡å¼€å‘ä¹‹æ—…å§ï¼** ğŸš€
