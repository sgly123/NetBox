#!/bin/bash

# NetBox CLI åŒ…è£…å™¨è„šæœ¬
# æä¾›ç®€æ´çš„å‘½ä»¤è¡Œä½“éªŒ: netbox init MyProject --template web_server

# è·å–è„šæœ¬æ‰€åœ¨ç›®å½•
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"

# æ£€æŸ¥æ˜¯å¦åœ¨NetBoxé¡¹ç›®ç›®å½•ä¸­
if [ -f "$SCRIPT_DIR/tools/netbox-cli-v2.py" ]; then
    # åœ¨NetBoxé¡¹ç›®ç›®å½•ä¸­
    NETBOX_CLI="$SCRIPT_DIR/tools/netbox-cli-v2.py"
else
    # å…¨å±€å®‰è£…çš„æƒ…å†µï¼ŒæŸ¥æ‰¾NetBoxé¡¹ç›®ç›®å½•
    # å°è¯•ä»å½“å‰ç›®å½•å‘ä¸ŠæŸ¥æ‰¾
    CURRENT_DIR="$PWD"
    while [ "$CURRENT_DIR" != "/" ]; do
        if [ -f "$CURRENT_DIR/tools/netbox-cli-v2.py" ]; then
            NETBOX_CLI="$CURRENT_DIR/tools/netbox-cli-v2.py"
            break
        fi
        CURRENT_DIR="$(dirname "$CURRENT_DIR")"
    done
    
    # å¦‚æœè¿˜æ˜¯æ‰¾ä¸åˆ°ï¼Œå°è¯•å¸¸è§çš„å®‰è£…è·¯å¾„
    if [ -z "$NETBOX_CLI" ]; then
        COMMON_PATHS=(
            "$HOME/æ¡Œé¢/NetBox"
            "$HOME/Desktop/NetBox"
            "$HOME/NetBox"
            "/opt/NetBox"
            "/usr/local/NetBox"
        )
        
        for path in "${COMMON_PATHS[@]}"; do
            if [ -f "$path/tools/netbox-cli-v2.py" ]; then
                NETBOX_CLI="$path/tools/netbox-cli-v2.py"
                break
            fi
        done
    fi
fi

# æ£€æŸ¥Pythonè„šæœ¬æ˜¯å¦å­˜åœ¨
if [ ! -f "$NETBOX_CLI" ]; then
    echo "âŒ é”™è¯¯: æ‰¾ä¸åˆ°NetBox CLIè„šæœ¬"
    echo "ğŸ“ æœŸæœ›è·¯å¾„: $NETBOX_CLI"
    echo "ğŸ’¡ è¯·ç¡®ä¿åœ¨NetBoxé¡¹ç›®æ ¹ç›®å½•ä¸­è¿è¡Œæ­¤å‘½ä»¤"
    echo "ğŸ’¡ æˆ–è€…è¿è¡Œå®‰è£…è„šæœ¬: ./install_netbox.sh"
    exit 1
fi

# æ£€æŸ¥Pythonæ˜¯å¦å¯ç”¨
if ! command -v python3 &> /dev/null; then
    echo "âŒ é”™è¯¯: æœªæ‰¾åˆ°python3"
    echo "ğŸ’¡ è¯·å®‰è£…Python 3.7+: sudo apt install python3"
    exit 1
fi

# æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯ï¼ˆå¦‚æœç”¨æˆ·æ²¡æœ‰æä¾›å‚æ•°ï¼‰
if [ $# -eq 0 ]; then
    echo "ğŸš€ NetBox CLI - ä¼ä¸šçº§è·¨å¹³å°ç½‘ç»œæ¡†æ¶"
    echo "============================================================"
    echo ""
    echo "ğŸ“‹ å¯ç”¨å‘½ä»¤:"
    echo "  init [é¡¹ç›®å] [--template æ¨¡æ¿å]    åˆ›å»ºæ–°é¡¹ç›®"
    echo "  list-templates                      åˆ—å‡ºæ‰€æœ‰å¯ç”¨æ¨¡æ¿"
    echo "  build [--type Debug|Release]        æ„å»ºé¡¹ç›®"
    echo "  test                                è¿è¡Œæµ‹è¯•"
    echo "  run [ç›®æ ‡ç¨‹åº]                      è¿è¡Œç¨‹åº"
    echo "  info                                æ˜¾ç¤ºé¡¹ç›®ä¿¡æ¯"
    echo "  clean                               æ¸…ç†æ„å»ºæ–‡ä»¶"
    echo ""
    echo "ğŸ¯ æ¨¡æ¿ç±»å‹:"
    echo "  default      - é»˜è®¤æ¨¡æ¿ (åŸºç¡€åŠŸèƒ½)"
    echo "  web_server   - WebæœåŠ¡å™¨æ¨¡æ¿"
    echo "  game_server  - æ¸¸æˆæœåŠ¡å™¨æ¨¡æ¿"
    echo "  microservice - å¾®æœåŠ¡æ¨¡æ¿"
    echo ""
    echo "ğŸ’¡ ç¤ºä¾‹:"
    echo "  ./netbox init MyProject                    # ä½¿ç”¨é»˜è®¤æ¨¡æ¿"
    echo "  ./netbox init MyWebApp --template web_server    # ä½¿ç”¨WebæœåŠ¡å™¨æ¨¡æ¿"
    echo "  ./netbox init MyGameApp --template game_server  # ä½¿ç”¨æ¸¸æˆæœåŠ¡å™¨æ¨¡æ¿"
    echo "  ./netbox list-templates                    # æŸ¥çœ‹æ‰€æœ‰æ¨¡æ¿"
    echo ""
    exit 0
fi

# æ‰§è¡ŒPython CLIè„šæœ¬ï¼Œä¼ é€’æ‰€æœ‰å‚æ•°
exec python3 "$NETBOX_CLI" "$@"
