# NetBox æ’ä»¶åŒ–æ¡†æ¶å‡çº§æŠ¥å‘Š

## ğŸ¯ å‡çº§æ¦‚è¿°

NetBox é¡¹ç›®å·²æˆåŠŸä»ç¡¬ç¼–ç åº”ç”¨åˆ‡æ¢å‡çº§ä¸º**é…ç½®é©±åŠ¨çš„æ’ä»¶åŒ–æ¡†æ¶**ï¼Œå®ç°äº†çœŸæ­£çš„åº”ç”¨æœåŠ¡å™¨æ¡†æ¶ã€‚

## ğŸš€ æ ¸å¿ƒæ”¹è¿›

### **1. ä»ç¡¬ç¼–ç åˆ°é…ç½®é©±åŠ¨**

**å‡çº§å‰ï¼š**
```cpp
// main.cpp - ç¡¬ç¼–ç åˆ›å»ºåº”ç”¨
EchoServer* server = new EchoServer(ip, port, IOMultiplexer::IOType::EPOLL, pool);
```

**å‡çº§åï¼š**
```cpp
// main.cpp - é…ç½®é©±åŠ¨åˆ›å»ºåº”ç”¨
std::string app_type = config.getString("application.type", "echo");
auto server = registry.createApplication(app_type, ip, port, io_type, pool);
```

### **2. åº”ç”¨æ³¨å†Œè¡¨ç³»ç»Ÿ**

**æ ¸å¿ƒç»„ä»¶ï¼š**
- `ApplicationRegistry`: å•ä¾‹æ³¨å†Œè¡¨ï¼Œç®¡ç†æ‰€æœ‰åº”ç”¨ç±»å‹
- `REGISTER_APPLICATION`: è‡ªåŠ¨æ³¨å†Œå®ï¼Œç®€åŒ–æ’ä»¶æ³¨å†Œ
- `CreateFunc`: ç»Ÿä¸€çš„åº”ç”¨åˆ›å»ºå‡½æ•°ç±»å‹

**ä½¿ç”¨ç¤ºä¾‹ï¼š**
```cpp
// EchoServerPlugin.cpp - è‡ªåŠ¨æ³¨å†Œ
static bool registerEchoServer() {
    return ApplicationRegistry::getInstance().registerApplication("echo", 
        [](const std::string& ip, int port, IOMultiplexer::IOType io_type, IThreadPool* pool) {
            return std::make_unique<EchoServer>(ip, port, io_type, pool);
        });
}
static bool g_echoServerRegistered = registerEchoServer();
```

### **3. å¢å¼ºé…ç½®ç³»ç»Ÿ**

**æ–°å¢åŠŸèƒ½ï¼š**
- âœ… **å¤šæ ¼å¼æ”¯æŒ**: YAML + ä¼ ç»Ÿ key=value æ ¼å¼
- âœ… **åˆ†å±‚é…ç½®**: `application.type`, `network.port` ç­‰
- âœ… **ç±»å‹å®‰å…¨**: è‡ªåŠ¨ç±»å‹è½¬æ¢å’Œé»˜è®¤å€¼
- âœ… **æ³¨é‡Šå¤„ç†**: è‡ªåŠ¨è¿‡æ»¤é…ç½®ä¸­çš„æ³¨é‡Š

**é…ç½®ç¤ºä¾‹ï¼š**
```yaml
# config.yaml
application:
  type: echo          # åº”ç”¨ç±»å‹

network:
  ip: 127.0.0.1       # ç›‘å¬IP
  port: 8888          # ç›‘å¬ç«¯å£
  io_type: epoll      # IOç±»å‹

threading:
  worker_threads: 10  # çº¿ç¨‹æ•°
```

## ğŸ® ä½¿ç”¨æ¼”ç¤º

### **åœºæ™¯1ï¼šè¿è¡ŒEchoæœåŠ¡å™¨**
```bash
# config.yaml
application:
  type: echo
network:
  port: 8888

./NetBox config.yaml
# è¾“å‡ºï¼šecho æœåŠ¡å™¨å·²å¯åŠ¨ï¼Œç­‰å¾…å®¢æˆ·ç«¯è¿æ¥...
```

### **åœºæ™¯2ï¼šåˆ‡æ¢IOæ¨¡å¼**
```bash
# config_select.yaml  
application:
  type: echo
network:
  port: 9999
  io_type: select

./NetBox config_select.yaml
# è¾“å‡ºï¼šecho æœåŠ¡å™¨å·²å¯åŠ¨... (IOç±»å‹: select, çº¿ç¨‹æ•°: 4)
```

### **åœºæ™¯3ï¼šé”™è¯¯å¤„ç†**
```bash
# config_error.yaml
application:
  type: nonexistent_app

./NetBox config_error.yaml
# è¾“å‡ºï¼š
# [ERROR] æœªæ‰¾åˆ°åº”ç”¨ç±»å‹: nonexistent_app
# [INFO] å¯ç”¨çš„åº”ç”¨ç±»å‹: 
# [INFO]   - echo
```

## ğŸ“Š æŠ€æœ¯æ¶æ„

### **æ’ä»¶åŒ–æ¶æ„å›¾**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            ä¸»ç¨‹åº (main.cpp)        â”‚
â”‚         é…ç½®é©±åŠ¨ + åŠ¨æ€åˆ›å»º          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚        åº”ç”¨æ³¨å†Œè¡¨ (Registry)         â”‚
â”‚     å·¥å‚æ¨¡å¼ + æ³¨å†Œæ¨¡å¼ç®¡ç†          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚         åº”ç”¨æ’ä»¶ (Plugins)          â”‚
â”‚    EchoServer, SanguoshaServer...   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚        åº”ç”¨åŸºç±» (Framework)         â”‚
â”‚      ApplicationServer æ¡†æ¶         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚         ç½‘ç»œå±‚ + åè®®å±‚             â”‚
â”‚      TcpServer + ProtocolRouter     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### **è®¾è®¡æ¨¡å¼åº”ç”¨**
- **å•ä¾‹æ¨¡å¼**: ApplicationRegistry å…¨å±€å”¯ä¸€
- **å·¥å‚æ¨¡å¼**: æ ¹æ®é…ç½®åŠ¨æ€åˆ›å»ºåº”ç”¨å®ä¾‹
- **æ³¨å†Œæ¨¡å¼**: åº”ç”¨è‡ªåŠ¨æ³¨å†Œåˆ°æ³¨å†Œè¡¨
- **ç­–ç•¥æ¨¡å¼**: æ”¯æŒå¤šç§IOç±»å‹å’Œé…ç½®æ ¼å¼

## ğŸ¯ é¡¹ç›®ä»·å€¼æå‡

### **æŠ€æœ¯æ·±åº¦**
| ç»´åº¦ | å‡çº§å‰ | å‡çº§å | æå‡ |
|------|--------|--------|------|
| **æ¶æ„è®¾è®¡** | 9.0/10 | 9.5/10 | +0.5 |
| **å·¥ç¨‹å®è·µ** | 9.0/10 | 9.5/10 | +0.5 |
| **æ‰©å±•æ€§** | 8.0/10 | 9.5/10 | +1.5 |
| **é…ç½®ç®¡ç†** | 7.0/10 | 9.0/10 | +2.0 |
| **æ€»è¯„åˆ†** | 8.7/10 | **9.2/10** | **+0.5** |

### **é¢è¯•ä»·å€¼**
- ğŸ¯ **æ¶æ„æ¼”è¿›**: å±•ç¤ºä»å•ä½“åˆ°æ’ä»¶åŒ–çš„æ€ç»´è¿‡ç¨‹
- ğŸ¯ **è®¾è®¡æ¨¡å¼**: å¤šç§è®¾è®¡æ¨¡å¼çš„å®é™…åº”ç”¨
- ğŸ¯ **å·¥ç¨‹æ€ç»´**: é…ç½®é©±åŠ¨ã€é”™è¯¯å¤„ç†ã€å‘ä¸‹å…¼å®¹
- ğŸ¯ **æ‰©å±•æ€§**: ä¸ºæœªæ¥çš„ä¸‰å›½æ€ã€Mini Redis å¥ å®šåŸºç¡€

## ğŸš€ æœªæ¥æ‰©å±•

### **æ·»åŠ æ–°åº”ç”¨çš„æ­¥éª¤**
1. **å®ç°åº”ç”¨ç±»**: ç»§æ‰¿ `ApplicationServer`
2. **åˆ›å»ºæ’ä»¶æ–‡ä»¶**: ä½¿ç”¨è‡ªåŠ¨æ³¨å†Œæœºåˆ¶
3. **æ›´æ–°é…ç½®æ–‡ä»¶**: è®¾ç½® `application.type`
4. **é‡å¯ç¨‹åº**: æ— éœ€é‡ç¼–è¯‘æ¡†æ¶ä»£ç 

### **ä¸‰å›½æ€æœåŠ¡å™¨ç¤ºä¾‹**
```cpp
// SanguoshaServerPlugin.cpp
static bool registerSanguoshaServer() {
    return ApplicationRegistry::getInstance().registerApplication("sanguosha", 
        [](const std::string& ip, int port, IOMultiplexer::IOType io_type, IThreadPool* pool) {
            return std::make_unique<SanguoshaServer>(ip, port, io_type, pool);
        });
}
static bool g_sanguoshaRegistered = registerSanguoshaServer();
```

```yaml
# config_sanguosha.yaml
application:
  type: sanguosha
network:
  port: 8888
sanguosha:
  max_players_per_room: 8
  enable_ai: true
```

## ğŸ‰ æ€»ç»“

NetBox æ’ä»¶åŒ–æ¡†æ¶å‡çº§**åœ†æ»¡æˆåŠŸ**ï¼

**æ ¸å¿ƒæˆå°±ï¼š**
- âœ… **é…ç½®é©±åŠ¨**: é€šè¿‡ä¿®æ”¹é…ç½®æ–‡ä»¶åˆ‡æ¢åº”ç”¨ï¼Œæ— éœ€é‡ç¼–è¯‘
- âœ… **æ’ä»¶åŒ–**: çœŸæ­£çš„æ’ä»¶æ¶æ„ï¼Œæ”¯æŒåŠ¨æ€æ‰©å±•
- âœ… **å‘ä¸‹å…¼å®¹**: å®Œå…¨å…¼å®¹åŸæœ‰åŠŸèƒ½å’Œé…ç½®
- âœ… **å·¥ç¨‹åŒ–**: å®Œå–„çš„é”™è¯¯å¤„ç†ã€æ—¥å¿—è®°å½•ã€æµ‹è¯•è„šæœ¬

**æŠ€æœ¯äº®ç‚¹ï¼š**
- ğŸ¯ **åº”ç”¨æ³¨å†Œè¡¨**: ä¼˜é›…çš„æ’ä»¶ç®¡ç†æœºåˆ¶
- ğŸ¯ **å¢å¼ºé…ç½®**: æ”¯æŒYAMLå’Œåˆ†å±‚é…ç½®
- ğŸ¯ **è®¾è®¡æ¨¡å¼**: å¤šç§æ¨¡å¼çš„å®é™…åº”ç”¨
- ğŸ¯ **æ‰©å±•æ€§**: ä¸ºæœªæ¥åº”ç”¨å¥ å®šåšå®åŸºç¡€

è¿™ä¸ªå‡çº§å°† NetBox ä»ä¸€ä¸ª"ç½‘ç»œæœåŠ¡å™¨"çœŸæ­£å‡çº§ä¸ºä¸€ä¸ª**ä¼ä¸šçº§åº”ç”¨æœåŠ¡å™¨æ¡†æ¶**ï¼ŒæŠ€æœ¯å«é‡å’Œé¢è¯•ä»·å€¼éƒ½å¾—åˆ°äº†æ˜¾è‘—æå‡ï¼
